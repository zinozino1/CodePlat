{"ast":null,"code":"import React, { useCallback, useState } from \"react\";\nimport { Form, Input, Button } from \"antd\";\nimport Head from \"next/head\";\nimport AuthLayout from \"../../components/layout/AuthLayout\";\nimport Header from \"../../components/common/Header\";\nimport wrapper from \"../../store/configureStore\";\nimport { setUserRequestAction } from \"../../reducers/user\";\nimport { END } from \"redux-saga\";\nimport client from \"../../lib/api/client\";\nimport axios from \"axios\";\nimport Router, { withRouter } from \"next/router\";\n/**\n * @author 박진호\n * @version 1.0\n * @summary 비밀번호 변경 페이지\n */\n\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\n\nconst passwordUpdate = () => {\n  // local state\n  const {\n    0: currentPassword,\n    1: setCurrentPassword\n  } = useState(\"\");\n  const {\n    0: newPassword,\n    1: setNewPassword\n  } = useState(\"\");\n  const {\n    0: newPasswordConfirm,\n    1: setNewPasswordConfirm\n  } = useState(\"\");\n  const {\n    0: newPasswordMatchError,\n    1: setNewPasswordMatchError\n  } = useState(false);\n  const {\n    0: currentPasswordError,\n    1: setCurrentPasswordError\n  } = useState(false); // event listener\n\n  const onChangeCurrentPassword = useCallback(e => {\n    setCurrentPassword(e.target.value);\n  }, []);\n  const onChangeNewPassword = useCallback(e => {\n    setNewPassword(e.target.value);\n  }, []);\n  const onChangeNewPasswordConfirm = useCallback(e => {\n    setNewPasswordConfirm(e.target.value);\n  }, []);\n  const onSubmit = useCallback(() => {\n    if (currentPassword === \"\" || newPassword === \"\" || newPasswordConfirm === \"\") {\n      alert(\"빈칸을 채워주세요.\");\n      return;\n    }\n\n    axios.patch(`/api/users/changePassword`, {\n      password: currentPassword,\n      newPassword: newPassword\n    }).then(res => {\n      if (res.data.message) {\n        setCurrentPasswordError(true);\n        alert(\"현재 비밀번호가 일치하지 않습니다.\");\n        return;\n      } else if (res.data.success) {\n        alert(\"비밀번호 변경 성공!\");\n        Router.push(\"/\");\n      } else {\n        alert(\"비밀번호 변경 성공!\");\n        Router.push(\"/\");\n      }\n    }).catch(err => {\n      console.log(err);\n    });\n  }, [currentPassword, newPassword, newPasswordConfirm]);\n  return /*#__PURE__*/_jsxs(_Fragment, {\n    children: [/*#__PURE__*/_jsxs(Head, {\n      children: [/*#__PURE__*/_jsx(\"meta\", {\n        charSet: \"utf-8\"\n      }), /*#__PURE__*/_jsx(\"title\", {\n        children: \"\\uBE44\\uBC00\\uBC88\\uD638 \\uBCC0\\uACBD\"\n      })]\n    }), /*#__PURE__*/_jsx(Header, {}), /*#__PURE__*/_jsx(AuthLayout, {\n      children: /*#__PURE__*/_jsxs(\"div\", {\n        style: {\n          background: \"#fff\",\n          borderRadius: \"5px\",\n          padding: \"40px\",\n          margin: \"140px 0\"\n        },\n        children: [/*#__PURE__*/_jsx(\"h2\", {\n          children: \"\\uBE44\\uBC00\\uBC88\\uD638 \\uBCC0\\uACBD\"\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          style: {\n            marginBottom: \"10px\"\n          },\n          children: [/*#__PURE__*/_jsx(\"span\", {\n            style: {\n              color: \"red\"\n            },\n            children: \"*\"\n          }), \" \\uC548\\uC804\\uD55C \\uBE44\\uBC00\\uBC88\\uD638\\uB85C \\uACC4\\uC815\\uC744 \\uBCF4\\uD638\\uD558\\uC138\\uC694.\"]\n        }), /*#__PURE__*/_jsxs(Form, {\n          children: [/*#__PURE__*/_jsx(Form.Item, {\n            name: \"current-password\",\n            rules: [{\n              required: true,\n              message: \"현재 비밀번호를 입력해주세요.\"\n            }],\n            hasFeedback: true,\n            children: /*#__PURE__*/_jsx(Input.Password, {\n              placeholder: \"\\uD604\\uC7AC \\uBE44\\uBC00\\uBC88\\uD638\",\n              onChange: onChangeCurrentPassword\n            })\n          }), /*#__PURE__*/_jsx(Form.Item, {\n            name: \"new-password\",\n            rules: [{\n              required: true,\n              message: \"새 비밀번호를 입력해주세요.\"\n            }, {\n              min: 8,\n              message: \"8자리 이상 비밀번호를 입력해주세요.\"\n            }],\n            hasFeedback: true,\n            children: /*#__PURE__*/_jsx(Input.Password, {\n              placeholder: \"\\uC0C8 \\uBE44\\uBC00\\uBC88\\uD638\",\n              onChange: onChangeNewPassword\n            })\n          }), /*#__PURE__*/_jsx(Form.Item, {\n            name: \"new-password-confirm\",\n            dependencies: [\"new-password\"],\n            rules: [{\n              required: true,\n              message: \"새 비밀번호 확인을 입력해주세요.\"\n            }, {\n              min: 8,\n              message: \"8자리 이상 비밀번호를 입력해주세요.\"\n            }, ({\n              getFieldValue\n            }) => ({\n              validator(_, value) {\n                if (!value || getFieldValue(\"new-password\") === value) {\n                  return Promise.resolve();\n                }\n\n                return Promise.reject(\"새 비밀번호가 일치하지 않습니다.\");\n              }\n\n            })],\n            hasFeedback: true,\n            children: /*#__PURE__*/_jsx(Input.Password, {\n              placeholder: \"\\uC0C8 \\uBE44\\uBC00\\uBC88\\uD638 \\uD655\\uC778\",\n              onChange: onChangeNewPasswordConfirm\n            })\n          }), /*#__PURE__*/_jsx(Form.Item, {\n            children: /*#__PURE__*/_jsx(\"div\", {\n              style: {\n                textAlign: \"center\"\n              },\n              children: /*#__PURE__*/_jsx(Button, {\n                onClick: onSubmit,\n                children: \"\\uD655\\uC778\"\n              })\n            })\n          })]\n        })]\n      })\n    })]\n  });\n};\n\nexport const getServerSideProps = wrapper.getServerSideProps(async context => {\n  //console.log(context);\n  const cookie = context.req ? context.req.headers.cookie : \"\";\n  client.defaults.headers.Cookie = \"\";\n\n  if (context.req && cookie) {\n    //console.log(\"fuckcookie\", cookie);\n    client.defaults.withCredentials = true;\n    client.defaults.headers.Cookie = cookie;\n  }\n\n  context.store.dispatch(setUserRequestAction()); //context.store.dispatch(mainLoadPostsReqeustAction());\n  //context.store.dispatch(END);\n\n  context.store.dispatch(END);\n  await context.store.sagaTask.toPromise();\n});\nexport default withRouter(passwordUpdate);","map":null,"metadata":{},"sourceType":"module"}