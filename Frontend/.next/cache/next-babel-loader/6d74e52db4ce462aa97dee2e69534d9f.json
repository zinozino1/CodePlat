{"ast":null,"code":"import React, { useState, useCallback, useEffect } from \"react\";\nimport styled from \"styled-components\";\nimport EditProfileForm from \"./EditProfileForm\";\nimport SkillFilterForm from \"../common/contents/SkillFilterForm\";\nimport { Button, Card } from \"antd\";\nimport { useSelector } from \"react-redux\";\nimport { SERVER_URL } from \"../../lib/constant/constant\";\nimport shortid from \"shortid\";\nimport { message } from \"antd\";\nimport axios from \"axios\";\nimport FormData from \"form-data\";\n/**\n * @author 박진호\n * @version 1.1\n * @summary 프로필 수정 폼 + 기술 스택 수정 폼 컨테이너 컴포넌트\n */\n\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nconst ProfileReviseFormWrapper = styled.div.withConfig({\n  displayName: \"EditProfile__ProfileReviseFormWrapper\",\n  componentId: \"sc-2rim2x-0\"\n})([\"display:flex;padding:2rem 0;.edit-profile-form{flex:1;padding:20px;}.skill-filter-form{flex:2;padding:20px;}@media (max-width:900px){flex-direction:column;}\"]);\n\nconst EditProfile = () => {\n  // redux\n  const {\n    me\n  } = useSelector(state => state.user);\n  const {\n    skill\n  } = useSelector(state => state.skill); // local state\n\n  const {\n    0: nickname,\n    1: setNickname\n  } = useState(me && me.nickname);\n  const {\n    0: githubId,\n    1: setGithubId\n  } = useState(\"\");\n  const {\n    0: gitSecret,\n    1: setGitSecret\n  } = useState(false);\n  const {\n    0: profileImage,\n    1: setProfileImage\n  } = useState(null);\n  const {\n    0: loading,\n    1: setLoading\n  } = useState(false); // event listener\n\n  const onChangeNickname = useCallback(e => {\n    setNickname(e.target.value);\n  }, []);\n  const onChangeGithubId = useCallback(e => {\n    setGithubId(e.target.value);\n  }, []);\n  const onToggleGitSecret = useCallback(() => {\n    setGitSecret(!gitSecret);\n  }, [gitSecret]);\n  const onChangeProfileImage = useCallback(e => {\n    setProfileImage(e);\n  }, []);\n  const onDeleteProfileImage = useCallback(e => {\n    setProfileImage(null);\n  }, []);\n  const onSubmit = useCallback(() => {\n    setLoading(true);\n    const config = {\n      headers: {\n        Accept: \"application/json\",\n        enctype: \"multipart/form-data\"\n      }\n    };\n    const formData = new FormData();\n    formData.append(\"nickname\", nickname);\n    formData.append(\"githubUrl\", githubId);\n    formData.append(\"techStack\", JSON.stringify(skill));\n    formData.append(\"secretGithub\", gitSecret);\n    formData.append(\"avatar\", profileImage);\n    axios.patch(`/api/users`, formData, config).then(res => {\n      submitDoneMessage();\n    }).catch(err => {\n      console.log(err);\n    });\n    setLoading(false);\n  }, [skill, nickname, githubId, gitSecret, profileImage]); // helper method\n\n  const submitDoneMessage = () => {\n    message.success({\n      content: \"저장 완료!\",\n      className: \"custom-class\",\n      style: {\n        marginTop: \"5vh\"\n      }\n    });\n  }; // hooks\n\n\n  useEffect(() => {\n    setProfileImage({\n      uid: shortid.generate(),\n      url: `${SERVER_URL}/${me.avatarUrl}`,\n      thumbUrl: `${SERVER_URL}/${me.avatarUrl}`,\n      status: \"done\"\n    });\n    setNickname(me.nickname);\n    setGithubId(me.githubId);\n  }, [me]);\n  useEffect(() => {\n    if (me) {\n      setGitSecret(me.secretGithub);\n      setGithubId(me.githubUrl);\n    }\n  }, [me]);\n  if (!me) return null;\n  return /*#__PURE__*/_jsxs(_Fragment, {\n    children: [/*#__PURE__*/_jsxs(ProfileReviseFormWrapper, {\n      children: [/*#__PURE__*/_jsx(\"div\", {\n        className: \"edit-profile-form\",\n        children: /*#__PURE__*/_jsx(EditProfileForm, {\n          onChangeProfileImage: onChangeProfileImage,\n          onDeleteProfileImage: onDeleteProfileImage,\n          onChangeNickname: onChangeNickname,\n          onChangeGithubId: onChangeGithubId,\n          onToggleGitSecret: onToggleGitSecret,\n          gitSecret: gitSecret\n        })\n      }), /*#__PURE__*/_jsx(\"div\", {\n        className: \"skill-filter-form\",\n        children: /*#__PURE__*/_jsxs(Card, {\n          title: \"\\uAD00\\uC2EC \\uAE30\\uC220 \\uC218\\uC815\",\n          bordered: true,\n          children: [\" \", /*#__PURE__*/_jsx(SkillFilterForm, {\n            type: \"mypage\",\n            values: me.techStack,\n            isEdit: true\n          })]\n        })\n      })]\n    }), /*#__PURE__*/_jsx(\"div\", {\n      style: {\n        textAlign: \"center\"\n      },\n      children: /*#__PURE__*/_jsx(Button, {\n        type: \"primary\",\n        onClick: onSubmit,\n        loading: loading,\n        style: {\n          background: \"#313355\",\n          color: \"#fff\",\n          border: \"1px solid #313355\"\n        },\n        children: \"\\uC800\\uC7A5\\uD558\\uAE30\"\n      })\n    })]\n  });\n};\n\nexport default EditProfile;","map":null,"metadata":{},"sourceType":"module"}