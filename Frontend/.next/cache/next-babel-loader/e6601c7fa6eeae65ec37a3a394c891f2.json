{"ast":null,"code":"function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { useState, useEffect, useCallback } from \"react\";\nimport Link from \"next/link\";\nimport { Layout, Menu, Button, Badge } from \"antd\";\nimport { BellOutlined } from \"@ant-design/icons\";\nimport styled, { css } from \"styled-components\";\nimport { withRouter } from \"next/router\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { logoutRequestAction } from \"../../reducers/user\";\nimport firebase from \"../../firebase\";\n/**\n * @author 박진호\n * @version 1.0\n * @summary 헤더 컴포넌트(함수형)\n */\n// style\n\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nconst AntHeader = Layout.Header;\nconst HeaderWrapper = styled(AntHeader).withConfig({\n  displayName: \"Header__HeaderWrapper\",\n  componentId: \"sc-1jkvt1g-0\"\n})([\"position:fixed;z-index:10;width:100%;background:#16172b;\"]);\nconst InnerHeader = styled.div.withConfig({\n  displayName: \"Header__InnerHeader\",\n  componentId: \"sc-1jkvt1g-1\"\n})([\"width:1300px;margin:0 auto;display:flex;.ant-menu-horizontal{border:none;}@media (max-width:1368px){width:100%;}@media (max-width:1368px){justify-content:space-between;}\"]);\nconst LogoWrapper = styled.div.withConfig({\n  displayName: \"Header__LogoWrapper\",\n  componentId: \"sc-1jkvt1g-2\"\n})([\"float:left;cursor:pointer;color:#fff;text-align:center;font-weight:bold;font-size:20px;width:100px;\"]);\nconst MenuWrapper = styled.div.withConfig({\n  displayName: \"Header__MenuWrapper\",\n  componentId: \"sc-1jkvt1g-3\"\n})([\"background:#16172b;font-size:18px;margin:0 auto;height:64px;display:flex;@media (max-width:950px){display:none;}\"]);\nconst MenuItemWrapper = styled.div.withConfig({\n  displayName: \"Header__MenuItemWrapper\",\n  componentId: \"sc-1jkvt1g-4\"\n})([\"padding:0 30px;a{color:#fff;font-weight:500;\", \"}\"], props => {\n  if (props.currentMenu) {\n    return css([\"color:#1890ff;\"]);\n  }\n});\nconst ButtonGroup = styled.div.withConfig({\n  displayName: \"Header__ButtonGroup\",\n  componentId: \"sc-1jkvt1g-5\"\n})([\".btn-register{margin-left:10px;background:#313355;border:1px solid #313355;&:hover{border:1px solid #16172b;}}.btn-logout{margin-left:10px;background:#313355;border:1px solid #313355;&:hover{border:1px solid #16172b;}}.btn-login{&:hover{color:#313355;border:1px solid #313355;}}.btn-mypage{&:hover{color:#313355;border:1px solid #313355;}}@media (max-width:768px){.btn-mypage,.btn-logout{width:70px;font-size:12px;padding:0;}}\"]);\nconst BadgeWrapper = styled.div.withConfig({\n  displayName: \"Header__BadgeWrapper\",\n  componentId: \"sc-1jkvt1g-6\"\n})([\"margin-right:60px;\"]);\nconst MobileMenuWrapper = styled.div.withConfig({\n  displayName: \"Header__MobileMenuWrapper\",\n  componentId: \"sc-1jkvt1g-7\"\n})([\"position:fixed;top:64px;left:0;right:0;width:100%;margin:0;background:#16172bcc;z-index:10;display:flex;justify-content:center;\", \" @media (min-width:950px){display:none;}\"], props => {\n  if (props.currentMenu) {\n    return css([\"color:#1890ff;\"]);\n  }\n});\n\nconst Header = ({\n  router\n}) => {\n  // redux\n  const dispatch = useDispatch();\n  const {\n    me,\n    logoutLoading\n  } = useSelector(state => state.user); // local state\n\n  const {\n    0: currentMenu,\n    1: setCurrentMenu\n  } = useState(null);\n  const {\n    0: globalCount,\n    1: setGlobalCount\n  } = useState(0);\n  const {\n    0: chatRoomsRef,\n    1: setChatRoomsRef\n  } = useState(firebase.database().ref(\"chatRooms\")); // event listener\n\n  const onLogout = useCallback(async () => {\n    let user = firebase.auth().currentUser;\n\n    if (user) {\n      await firebase.auth().signOut().then(() => {});\n      let firebaseMe = null;\n      await firebase.database().ref(\"users\").child(user.uid).once(\"value\", function (data) {\n        firebaseMe = data.val();\n      });\n      await firebase.database().ref(\"users\").child(user.uid).update(_objectSpread(_objectSpread({}, firebaseMe), {}, {\n        isInMypage: false\n      }));\n    }\n\n    dispatch(logoutRequestAction());\n  }, []);\n  useEffect(async () => {\n    setTimeout(() => {\n      let globalCount = 0;\n      let tmpChatRoomInfo = [];\n      me && chatRoomsRef.on(\"child_changed\", DataSnapshot => {\n        if (DataSnapshot.val()[me.nickname]) {\n          globalCount++;\n          setGlobalCount(globalCount);\n        } else {\n          tmpChatRoomInfo.forEach((v, i) => {\n            if (v.chatRoomId === DataSnapshot.val().id) {\n              globalCount -= v.count;\n            }\n          });\n          setGlobalCount(globalCount);\n        }\n      });\n      me && chatRoomsRef.on(\"child_added\", DataSnapshot => {\n        if (DataSnapshot.val()[me.nickname]) {\n          globalCount += DataSnapshot.val()[me.nickname].count;\n          tmpChatRoomInfo.push(DataSnapshot.val()[me.nickname]);\n          setGlobalCount(globalCount);\n        }\n      });\n      me && chatRoomsRef.on(\"child_removed\", DataSnapshot => {// deprecated.\n      });\n    }, 700);\n  }, []); // hooks\n\n  useEffect(() => {\n    const route = router.route.split(\"/\");\n    setCurrentMenu(`${route[2]}`);\n  }, [router]);\n  useEffect(() => {\n    return () => chatRoomsRef.off();\n  }, []);\n  return /*#__PURE__*/_jsxs(HeaderWrapper, {\n    children: [/*#__PURE__*/_jsxs(InnerHeader, {\n      children: [/*#__PURE__*/_jsx(Link, {\n        href: \"/\",\n        children: /*#__PURE__*/_jsx(\"a\", {\n          children: /*#__PURE__*/_jsx(LogoWrapper, {\n            children: \"CodePlat\"\n          })\n        })\n      }), /*#__PURE__*/_jsxs(MenuWrapper, {\n        children: [/*#__PURE__*/_jsx(MenuItemWrapper, {\n          className: \"menu-study\",\n          currentMenu: currentMenu === \"study\" ? true : false,\n          children: /*#__PURE__*/_jsx(Link, {\n            href: \"/articles/study\",\n            children: /*#__PURE__*/_jsx(\"a\", {\n              children: \"\\uC2A4\\uD130\\uB514\"\n            })\n          })\n        }, \"/articles/study\"), /*#__PURE__*/_jsx(MenuItemWrapper, {\n          className: \"menu-project\",\n          currentMenu: currentMenu === \"project\" ? true : false,\n          children: /*#__PURE__*/_jsx(Link, {\n            href: \"/articles/project\",\n            children: /*#__PURE__*/_jsx(\"a\", {\n              children: \"\\uD504\\uB85C\\uC81D\\uD2B8\"\n            })\n          })\n        }, \"/articles/project\"), /*#__PURE__*/_jsx(MenuItemWrapper, {\n          className: \"menu-forum\",\n          currentMenu: currentMenu === \"forum\" ? true : false,\n          children: /*#__PURE__*/_jsx(Link, {\n            href: \"/articles/forum\",\n            children: /*#__PURE__*/_jsx(\"a\", {\n              children: \"\\uD3EC\\uB7FC\"\n            })\n          })\n        }, \"/articles/forum\")]\n      }), me && /*#__PURE__*/_jsx(BadgeWrapper, {\n        children: /*#__PURE__*/_jsx(Badge, {\n          count: globalCount,\n          offset: [20, 0],\n          children: /*#__PURE__*/_jsx(Link, {\n            href: \"/mypage\",\n            children: /*#__PURE__*/_jsx(\"a\", {\n              className: \"head-example\",\n              children: /*#__PURE__*/_jsx(BellOutlined, {\n                style: {\n                  color: \"#fff\"\n                }\n              })\n            })\n          })\n        })\n      }), !me ? /*#__PURE__*/_jsxs(ButtonGroup, {\n        children: [/*#__PURE__*/_jsx(Link, {\n          href: \"/auth/login\",\n          children: /*#__PURE__*/_jsx(\"a\", {\n            children: /*#__PURE__*/_jsx(Button, {\n              className: \"btn-login\",\n              children: \"\\uB85C\\uADF8\\uC778\"\n            })\n          })\n        }), /*#__PURE__*/_jsx(Link, {\n          href: \"/auth/register\",\n          children: /*#__PURE__*/_jsx(\"a\", {\n            children: /*#__PURE__*/_jsx(Button, {\n              className: \"btn-register\",\n              type: \"primary\",\n              children: \"\\uD68C\\uC6D0\\uAC00\\uC785\"\n            })\n          })\n        })]\n      }) : /*#__PURE__*/_jsxs(ButtonGroup, {\n        children: [/*#__PURE__*/_jsx(Link, {\n          href: \"/mypage\",\n          children: /*#__PURE__*/_jsx(\"a\", {\n            children: /*#__PURE__*/_jsx(Button, {\n              className: \"btn-mypage\",\n              children: \"\\uB9C8\\uC774\\uD398\\uC774\\uC9C0\"\n            })\n          })\n        }), /*#__PURE__*/_jsx(Button, {\n          className: \"btn-logout\",\n          type: \"primary\",\n          onClick: onLogout,\n          loading: logoutLoading,\n          children: \"\\uB85C\\uADF8\\uC544\\uC6C3\"\n        })]\n      })]\n    }), /*#__PURE__*/_jsxs(MobileMenuWrapper, {\n      children: [/*#__PURE__*/_jsx(MenuItemWrapper, {\n        className: \"menu-study\",\n        currentMenu: currentMenu === \"study\" ? true : false,\n        children: /*#__PURE__*/_jsx(Link, {\n          href: \"/articles/study\",\n          children: /*#__PURE__*/_jsx(\"a\", {\n            children: \"\\uC2A4\\uD130\\uB514\"\n          })\n        })\n      }, \"/articles/study\"), /*#__PURE__*/_jsx(MenuItemWrapper, {\n        className: \"menu-project\",\n        currentMenu: currentMenu === \"project\" ? true : false,\n        children: /*#__PURE__*/_jsx(Link, {\n          href: \"/articles/project\",\n          children: /*#__PURE__*/_jsx(\"a\", {\n            children: \"\\uD504\\uB85C\\uC81D\\uD2B8\"\n          })\n        })\n      }, \"/articles/project\"), /*#__PURE__*/_jsx(MenuItemWrapper, {\n        className: \"menu-forum\",\n        currentMenu: currentMenu === \"forum\" ? true : false,\n        children: /*#__PURE__*/_jsx(Link, {\n          href: \"/articles/forum\",\n          children: /*#__PURE__*/_jsx(\"a\", {\n            children: \"\\uD3EC\\uB7FC\"\n          })\n        })\n      }, \"/articles/forum\")]\n    })]\n  });\n};\n\nexport default withRouter(Header);","map":null,"metadata":{},"sourceType":"module"}