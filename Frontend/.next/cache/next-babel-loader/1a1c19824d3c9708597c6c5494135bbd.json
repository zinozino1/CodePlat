{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState, useEffect, useCallback } from \"react\";\nimport Link from \"next/link\";\nimport { Layout, Menu, Button, Badge } from \"antd\";\nimport { BellOutlined } from \"@ant-design/icons\";\nimport styled, { css } from \"styled-components\";\nimport { withRouter } from \"next/router\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { logoutRequestAction } from \"../../reducers/user\";\nimport firebase from \"../../firebase\";\n/**\n * @author 박진호\n * @version 1.0\n * @summary 헤더 컴포넌트(함수형)\n */\n// style\n\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nvar AntHeader = Layout.Header;\nvar HeaderWrapper = styled(AntHeader).withConfig({\n  displayName: \"Header__HeaderWrapper\",\n  componentId: \"sc-1jkvt1g-0\"\n})([\"position:fixed;z-index:10;width:100%;background:#16172b;\"]);\nvar InnerHeader = styled.div.withConfig({\n  displayName: \"Header__InnerHeader\",\n  componentId: \"sc-1jkvt1g-1\"\n})([\"width:1300px;margin:0 auto;display:flex;.ant-menu-horizontal{border:none;}@media (max-width:1368px){width:100%;}@media (max-width:1368px){justify-content:space-between;}\"]);\nvar LogoWrapper = styled.div.withConfig({\n  displayName: \"Header__LogoWrapper\",\n  componentId: \"sc-1jkvt1g-2\"\n})([\"float:left;cursor:pointer;color:#fff;text-align:center;font-weight:bold;font-size:20px;width:100px;\"]);\nvar MenuWrapper = styled.div.withConfig({\n  displayName: \"Header__MenuWrapper\",\n  componentId: \"sc-1jkvt1g-3\"\n})([\"background:#16172b;font-size:18px;margin:0 auto;height:64px;display:flex;@media (max-width:950px){display:none;}\"]);\nvar MenuItemWrapper = styled.div.withConfig({\n  displayName: \"Header__MenuItemWrapper\",\n  componentId: \"sc-1jkvt1g-4\"\n})([\"padding:0 30px;a{color:#fff;font-weight:500;\", \"}\"], function (props) {\n  if (props.currentMenu) {\n    return css([\"color:#1890ff;\"]);\n  }\n});\nvar ButtonGroup = styled.div.withConfig({\n  displayName: \"Header__ButtonGroup\",\n  componentId: \"sc-1jkvt1g-5\"\n})([\".btn-register{margin-left:10px;background:#313355;border:1px solid #313355;&:hover{border:1px solid #16172b;}}.btn-logout{margin-left:10px;background:#313355;border:1px solid #313355;&:hover{border:1px solid #16172b;}}.btn-login{&:hover{color:#313355;border:1px solid #313355;}}.btn-mypage{&:hover{color:#313355;border:1px solid #313355;}}@media (max-width:768px){.btn-mypage,.btn-logout{width:70px;font-size:12px;padding:0;}}\"]);\nvar BadgeWrapper = styled.div.withConfig({\n  displayName: \"Header__BadgeWrapper\",\n  componentId: \"sc-1jkvt1g-6\"\n})([\"margin-right:60px;\"]);\nvar MobileMenuWrapper = styled.div.withConfig({\n  displayName: \"Header__MobileMenuWrapper\",\n  componentId: \"sc-1jkvt1g-7\"\n})([\"position:fixed;top:64px;left:0;right:0;width:100%;margin:0;background:#16172bcc;z-index:10;display:flex;justify-content:center;\", \" @media (min-width:950px){display:none;}\"], function (props) {\n  if (props.currentMenu) {\n    return css([\"color:#1890ff;\"]);\n  }\n});\n\nvar Header = function Header(_ref) {\n  var router = _ref.router;\n  // redux\n  var dispatch = useDispatch();\n\n  var _useSelector = useSelector(function (state) {\n    return state.user;\n  }),\n      me = _useSelector.me,\n      logoutLoading = _useSelector.logoutLoading; // local state\n\n\n  var _useState = useState(null),\n      currentMenu = _useState[0],\n      setCurrentMenu = _useState[1];\n\n  var _useState2 = useState(0),\n      globalCount = _useState2[0],\n      setGlobalCount = _useState2[1];\n\n  var _useState3 = useState(firebase.database().ref(\"chatRooms\")),\n      chatRoomsRef = _useState3[0],\n      setChatRoomsRef = _useState3[1]; // event listener\n\n\n  var onLogout = useCallback( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n    var user, firebaseMe;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            user = firebase.auth().currentUser;\n\n            if (!user) {\n              _context.next = 9;\n              break;\n            }\n\n            _context.next = 4;\n            return firebase.auth().signOut().then(function () {});\n\n          case 4:\n            firebaseMe = null;\n            _context.next = 7;\n            return firebase.database().ref(\"users\").child(user.uid).once(\"value\", function (data) {\n              firebaseMe = data.val();\n            });\n\n          case 7:\n            _context.next = 9;\n            return firebase.database().ref(\"users\").child(user.uid).update(_objectSpread(_objectSpread({}, firebaseMe), {}, {\n              isInMypage: false\n            }));\n\n          case 9:\n            dispatch(logoutRequestAction());\n\n          case 10:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  })), []);\n  useEffect( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            setTimeout(function () {\n              var globalCount = 0;\n              var tmpChatRoomInfo = [];\n              me && chatRoomsRef.on(\"child_changed\", function (DataSnapshot) {\n                if (DataSnapshot.val()[me.nickname]) {\n                  globalCount++;\n                  setGlobalCount(globalCount);\n                } else {\n                  tmpChatRoomInfo.forEach(function (v, i) {\n                    if (v.chatRoomId === DataSnapshot.val().id) {\n                      globalCount -= v.count;\n                    }\n                  });\n                  setGlobalCount(globalCount);\n                }\n              });\n              me && chatRoomsRef.on(\"child_added\", function (DataSnapshot) {\n                if (DataSnapshot.val()[me.nickname]) {\n                  globalCount += DataSnapshot.val()[me.nickname].count;\n                  tmpChatRoomInfo.push(DataSnapshot.val()[me.nickname]);\n                  setGlobalCount(globalCount);\n                }\n              });\n              me && chatRoomsRef.on(\"child_removed\", function (DataSnapshot) {// deprecated.\n              });\n            }, 700);\n\n          case 1:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  })), []); // hooks\n\n  useEffect(function () {\n    var route = router.route.split(\"/\");\n    setCurrentMenu(\"\".concat(route[2]));\n  }, [router]);\n  useEffect(function () {\n    return function () {\n      return chatRoomsRef.off();\n    };\n  }, []);\n  return /*#__PURE__*/_jsxs(HeaderWrapper, {\n    children: [/*#__PURE__*/_jsxs(InnerHeader, {\n      children: [/*#__PURE__*/_jsx(Link, {\n        href: \"/\",\n        children: /*#__PURE__*/_jsx(\"a\", {\n          children: /*#__PURE__*/_jsx(LogoWrapper, {\n            children: \"CodePlat\"\n          })\n        })\n      }), /*#__PURE__*/_jsxs(MenuWrapper, {\n        children: [/*#__PURE__*/_jsx(MenuItemWrapper, {\n          className: \"menu-study\",\n          currentMenu: currentMenu === \"study\" ? true : false,\n          children: /*#__PURE__*/_jsx(Link, {\n            href: \"/articles/study\",\n            children: /*#__PURE__*/_jsx(\"a\", {\n              children: \"\\uC2A4\\uD130\\uB514\"\n            })\n          })\n        }, \"/articles/study\"), /*#__PURE__*/_jsx(MenuItemWrapper, {\n          className: \"menu-project\",\n          currentMenu: currentMenu === \"project\" ? true : false,\n          children: /*#__PURE__*/_jsx(Link, {\n            href: \"/articles/project\",\n            children: /*#__PURE__*/_jsx(\"a\", {\n              children: \"\\uD504\\uB85C\\uC81D\\uD2B8\"\n            })\n          })\n        }, \"/articles/project\"), /*#__PURE__*/_jsx(MenuItemWrapper, {\n          className: \"menu-forum\",\n          currentMenu: currentMenu === \"forum\" ? true : false,\n          children: /*#__PURE__*/_jsx(Link, {\n            href: \"/articles/forum\",\n            children: /*#__PURE__*/_jsx(\"a\", {\n              children: \"\\uD3EC\\uB7FC\"\n            })\n          })\n        }, \"/articles/forum\")]\n      }), me && /*#__PURE__*/_jsx(BadgeWrapper, {\n        children: /*#__PURE__*/_jsx(Badge, {\n          count: globalCount,\n          offset: [20, 0],\n          children: /*#__PURE__*/_jsx(Link, {\n            href: \"/mypage\",\n            children: /*#__PURE__*/_jsx(\"a\", {\n              className: \"head-example\",\n              children: /*#__PURE__*/_jsx(BellOutlined, {\n                style: {\n                  color: \"#fff\"\n                }\n              })\n            })\n          })\n        })\n      }), !me ? /*#__PURE__*/_jsxs(ButtonGroup, {\n        children: [/*#__PURE__*/_jsx(Link, {\n          href: \"/auth/login\",\n          children: /*#__PURE__*/_jsx(\"a\", {\n            children: /*#__PURE__*/_jsx(Button, {\n              className: \"btn-login\",\n              children: \"\\uB85C\\uADF8\\uC778\"\n            })\n          })\n        }), /*#__PURE__*/_jsx(Link, {\n          href: \"/auth/register\",\n          children: /*#__PURE__*/_jsx(\"a\", {\n            children: /*#__PURE__*/_jsx(Button, {\n              className: \"btn-register\",\n              type: \"primary\",\n              children: \"\\uD68C\\uC6D0\\uAC00\\uC785\"\n            })\n          })\n        })]\n      }) : /*#__PURE__*/_jsxs(ButtonGroup, {\n        children: [/*#__PURE__*/_jsx(Link, {\n          href: \"/mypage\",\n          children: /*#__PURE__*/_jsx(\"a\", {\n            children: /*#__PURE__*/_jsx(Button, {\n              className: \"btn-mypage\",\n              children: \"\\uB9C8\\uC774\\uD398\\uC774\\uC9C0\"\n            })\n          })\n        }), /*#__PURE__*/_jsx(Button, {\n          className: \"btn-logout\",\n          type: \"primary\",\n          onClick: onLogout,\n          loading: logoutLoading,\n          children: \"\\uB85C\\uADF8\\uC544\\uC6C3\"\n        })]\n      })]\n    }), /*#__PURE__*/_jsxs(MobileMenuWrapper, {\n      children: [/*#__PURE__*/_jsx(MenuItemWrapper, {\n        className: \"menu-study\",\n        currentMenu: currentMenu === \"study\" ? true : false,\n        children: /*#__PURE__*/_jsx(Link, {\n          href: \"/articles/study\",\n          children: /*#__PURE__*/_jsx(\"a\", {\n            children: \"\\uC2A4\\uD130\\uB514\"\n          })\n        })\n      }, \"/articles/study\"), /*#__PURE__*/_jsx(MenuItemWrapper, {\n        className: \"menu-project\",\n        currentMenu: currentMenu === \"project\" ? true : false,\n        children: /*#__PURE__*/_jsx(Link, {\n          href: \"/articles/project\",\n          children: /*#__PURE__*/_jsx(\"a\", {\n            children: \"\\uD504\\uB85C\\uC81D\\uD2B8\"\n          })\n        })\n      }, \"/articles/project\"), /*#__PURE__*/_jsx(MenuItemWrapper, {\n        className: \"menu-forum\",\n        currentMenu: currentMenu === \"forum\" ? true : false,\n        children: /*#__PURE__*/_jsx(Link, {\n          href: \"/articles/forum\",\n          children: /*#__PURE__*/_jsx(\"a\", {\n            children: \"\\uD3EC\\uB7FC\"\n          })\n        })\n      }, \"/articles/forum\")]\n    })]\n  });\n};\n\nexport default withRouter(Header);","map":null,"metadata":{},"sourceType":"module"}