{"ast":null,"code":"var _jsxFileName = \"/Users/jinho/Project/ProjectFrontend/components/common/contents/CommentListItem.jsx\";\nimport React, { useCallback, useState, useEffect } from \"react\";\nimport styled from \"styled-components\";\nimport { Avatar, Popover, Comment, Input, Image, Checkbox } from \"antd\";\nimport ProfileModal from \"../../modal/ProfileModal\";\nimport { UserOutlined, LockOutlined, LikeOutlined, LikeFilled } from \"@ant-design/icons\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport useToggle from \"../../../hooks/useToggle\";\nimport { SERVER_URL } from \"../../../lib/constant/constant\";\nimport { addCommentRequestAction, deleteCommentRequestAction, likeCommentRequestAction, unLikeCommentRequestAction } from \"../../../reducers/post\";\nimport useInput from \"../../../hooks/useInput\";\nimport Router from \"next/router\";\nimport axios from \"axios\";\nimport ReCommentListItem from \"./ReCommentListItem\";\n/**\n * @author 박진호\n * @version 1.0\n * @summary 댓글 리스트 아이템 컴포넌트\n */\n// style\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst ReApplyFormWrapper = styled.div.withConfig({\n  displayName: \"CommentListItem__ReApplyFormWrapper\",\n  componentId: \"ugl3jc-0\"\n})([\"width:800px;display:flex;@media (max-width:768px){width:200px;display:block;}\"]);\nconst ReApplyInput = styled(Input.TextArea).withConfig({\n  displayName: \"CommentListItem__ReApplyInput\",\n  componentId: \"ugl3jc-1\"\n})([\"flex:7;\"]);\nconst ButtonWrapper = styled.div.withConfig({\n  displayName: \"CommentListItem__ButtonWrapper\",\n  componentId: \"ugl3jc-2\"\n})([\"line-height:30px;flex:1;.cancel-btn{cursor:pointer;margin-left:5px;}.submit-btn{cursor:pointer;color:#208fff;margin-left:10px;}.secret-btn{margin-left:10px;}\"]);\nconst CommentActivityWrapper = styled.div.withConfig({\n  displayName: \"CommentListItem__CommentActivityWrapper\",\n  componentId: \"ugl3jc-3\"\n})([\"font-size:11px;padding:0 3px;cursor:pointer;\"]);\n\nconst CommentListItem = ({\n  item,\n  post\n}) => {\n  // redux\n  const {\n    me\n  } = useSelector(state => state.user);\n  const dispatch = useDispatch(); // local state\n\n  const [reComment, onChangeReComment] = useInput(\"\");\n  const {\n    0: editCommentText,\n    1: setEditCommentText\n  } = useState(\"\");\n  const [isSecret, onToggleIsSecret] = useToggle(false);\n  const [isEdit, onToggleIsEdit] = useToggle(false);\n  const {\n    0: isEditSecret,\n    1: setIsEditSecret\n  } = useState(false);\n  const [applyToggle, onChangeApplyToggle] = useToggle(false);\n  const {\n    0: like,\n    1: setLike\n  } = useState(item.likes.some((v, i) => {\n    if (me && v.userId === me._id) {\n      return true;\n    }\n  }) ? true : false); // event listener\n\n  const onChangeEditCommentText = useCallback(e => {\n    setEditCommentText(e.target.value);\n  }, []);\n  const onToggleIsEditSecret = useCallback(() => {\n    setIsEditSecret(!isEditSecret);\n  }, [isEditSecret]);\n  const onToggleLike = useCallback(() => {\n    setLike(!like);\n\n    if (like) {\n      dispatch(unLikeCommentRequestAction({\n        user: me,\n        id: item.likes.find((v, i) => {\n          if (v.userId === me._id) {\n            return true;\n          }\n        })._id,\n        type: \"comment\",\n        commentId: item._id\n      }));\n    } else {\n      dispatch(likeCommentRequestAction({\n        user: me,\n        id: item._id,\n        type: \"comment\"\n      }));\n    }\n  }, [like, me, item]);\n  const onCancelEdit = useCallback(() => {\n    setEditCommentText(item.content);\n    setIsEditSecret(item.secretComment);\n    onToggleIsEdit();\n  }, [item, isEdit]);\n  const onReCommentSubmit = useCallback(async () => {\n    if (reComment === \"\") {\n      alert(\"내용을 입력해주세요.\");\n      return;\n    }\n\n    let submitConfirm = confirm(\"댓글을 등록하시겠습니까?\");\n\n    if (submitConfirm) {\n      await axios.post(`/api/comments`, {\n        postId: post._id,\n        type: post.type,\n        content: reComment,\n        commentTo: item._id,\n        secretComment: isSecret\n      }).then(res => {\n        onChangeApplyToggle();\n        Router.push(`/articles/${post.type}/${post._id}`);\n      }).catch(err => {\n        console.log(err);\n      });\n    } else {\n      return;\n    }\n  }, [post, item, reComment, isSecret]);\n  const onUpdateComment = useCallback(comment => {\n    if (editCommentText === \"\") {\n      alert(\"내용을 입력해주세요.\");\n      return;\n    }\n\n    let updateConfirm = confirm(\"수정하시겠습니까?\");\n\n    if (updateConfirm) {\n      axios.patch(`/api/comments`, {\n        commentId: comment._id,\n        content: editCommentText,\n        secretComment: isEditSecret\n      }).then(res => {\n        onToggleIsEdit();\n        Router.push(`/articles/${post.type}/${post._id}`);\n      }).catch(error => {\n        alert(\"댓글수정 실패\");\n      });\n    } else {\n      return;\n    }\n  }, [isEditSecret, editCommentText]);\n  const onDeleteComment = useCallback(async id => {\n    let confirmDelete = confirm(\"정말로 삭제하시겠습니까?\");\n\n    if (confirmDelete) {\n      let flag = false;\n      let parentId = null;\n      post.comments.forEach((v, i) => {\n        if (id === v.commentTo) {\n          flag = true;\n        }\n      });\n\n      if (flag) {\n        await axios.put(`/api/comments/parentDelete`, {\n          id\n        }).then(res => {\n          Router.push(`/articles/${post.type}/${post._id}`);\n        }).catch(err => {\n          console.log(err);\n        });\n      } else {\n        let child;\n        let parent;\n        let childInParentLength = 0;\n        post.comments.forEach((v, i) => {\n          if (id === v._id) {\n            child = v;\n          }\n        });\n        post.comments.forEach((v, i) => {\n          if (child.commentTo === v._id) {\n            parent = v;\n          }\n        });\n        post.comments.forEach((v, i) => {\n          if (parent && parent._id === v.commentTo) {\n            childInParentLength++;\n          }\n        });\n\n        if (parent && parent.isDelete && childInParentLength === 1) {\n          parentId = parent._id;\n          axios.delete(`/api/comments/${parentId}`).then(() => {\n            axios.delete(`/api/comments/${id}`).then(() => {\n              Router.push(`/articles/${post.type}/${post._id}`);\n              return;\n            });\n          });\n        } else {\n          await axios.delete(`/api/comments/${id}`).then(res => {\n            Router.push(`/articles/${post.type}/${post._id}`);\n          }).catch(err => {\n            console.log(err);\n          });\n        }\n      }\n    } else {\n      return;\n    }\n  }, [item, post]); // hooks\n\n  useEffect(() => {\n    setEditCommentText(item.content);\n    setIsEditSecret(item.secretComment);\n  }, [item]);\n  return /*#__PURE__*/_jsxDEV(\"li\", {\n    children: /*#__PURE__*/_jsxDEV(Comment, {\n      actions: me && !item.isDelete && (!applyToggle ? isEdit ? [/*#__PURE__*/_jsxDEV(_Fragment, {\n        children: /*#__PURE__*/_jsxDEV(ReApplyFormWrapper, {\n          children: [/*#__PURE__*/_jsxDEV(ReApplyInput, {\n            rows: 1,\n            onChange: onChangeEditCommentText,\n            defaultValue: item.content\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 275,\n            columnNumber: 23\n          }, this), /*#__PURE__*/_jsxDEV(ButtonWrapper, {\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"submit-btn\",\n              onClick: () => {\n                onUpdateComment(item);\n              },\n              children: \"\\uC218\\uC815\"\n            }, \"comment-list-reply-to-0\", false, {\n              fileName: _jsxFileName,\n              lineNumber: 282,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"cancel-btn\",\n              onClick: onCancelEdit,\n              children: \"\\uCDE8\\uC18C\"\n            }, \"comment-list-reply-to-1\", false, {\n              fileName: _jsxFileName,\n              lineNumber: 291,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"secret-btn\",\n              children: /*#__PURE__*/_jsxDEV(Checkbox, {\n                onChange: onToggleIsEditSecret,\n                style: {\n                  color: \"#999\"\n                },\n                defaultChecked: item.secretComment,\n                children: \"\\uBE44\\uBC00 \\uB313\\uAE00\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 302,\n                columnNumber: 27\n              }, this)\n            }, \"comment-list-reply-to-2\", false, {\n              fileName: _jsxFileName,\n              lineNumber: 298,\n              columnNumber: 25\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 281,\n            columnNumber: 23\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 274,\n          columnNumber: 21\n        }, this)\n      }, void 0, false)] : [/*#__PURE__*/_jsxDEV(CommentActivityWrapper, {\n        children: me && /*#__PURE__*/_jsxDEV(\"span\", {\n          style: {\n            marginRight: \"10px\"\n          },\n          onClick: onToggleLike,\n          children: [like ? /*#__PURE__*/_jsxDEV(LikeFilled, {\n            style: {\n              marginRight: \"3px\",\n              color: \"#1a91fe\"\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 322,\n            columnNumber: 27\n          }, this) : /*#__PURE__*/_jsxDEV(LikeOutlined, {\n            style: {\n              marginRight: \"3px\"\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 326,\n            columnNumber: 27\n          }, this), item.likes.length]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 317,\n          columnNumber: 23\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 315,\n        columnNumber: 19\n      }, this), /*#__PURE__*/_jsxDEV(CommentActivityWrapper, {\n        onClick: onChangeApplyToggle,\n        children: \"\\uB300\\uB313\\uAE00 \\uC4F0\\uAE30\"\n      }, \"comment-list-reply-to-0\", false, {\n        fileName: _jsxFileName,\n        lineNumber: 333,\n        columnNumber: 19\n      }, this), /*#__PURE__*/_jsxDEV(CommentActivityWrapper, {\n        children: item.writer && me._id === item.writer._id && /*#__PURE__*/_jsxDEV(\"span\", {\n          children: \"|\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 341,\n          columnNumber: 23\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 339,\n        columnNumber: 19\n      }, this), /*#__PURE__*/_jsxDEV(CommentActivityWrapper, {\n        children: item.writer && me._id === item.writer._id && /*#__PURE__*/_jsxDEV(\"span\", {\n          onClick: () => {\n            onDeleteComment(item._id);\n          },\n          children: \"\\uC0AD\\uC81C\"\n        }, \"comment-list-reply-to-0\", false, {\n          fileName: _jsxFileName,\n          lineNumber: 346,\n          columnNumber: 23\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 344,\n        columnNumber: 19\n      }, this), /*#__PURE__*/_jsxDEV(CommentActivityWrapper, {\n        children: item.writer && me._id === item.writer._id && /*#__PURE__*/_jsxDEV(\"span\", {\n          children: \"|\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 358,\n          columnNumber: 23\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 356,\n        columnNumber: 19\n      }, this), /*#__PURE__*/_jsxDEV(CommentActivityWrapper, {\n        children: item.writer && me._id === item.writer._id && /*#__PURE__*/_jsxDEV(\"span\", {\n          onClick: onToggleIsEdit,\n          children: \"\\uC218\\uC815\"\n        }, \"comment-list-reply-to-0\", false, {\n          fileName: _jsxFileName,\n          lineNumber: 363,\n          columnNumber: 23\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 361,\n        columnNumber: 19\n      }, this),,] : [/*#__PURE__*/_jsxDEV(_Fragment, {\n        children: /*#__PURE__*/_jsxDEV(ReApplyFormWrapper, {\n          children: [/*#__PURE__*/_jsxDEV(ReApplyInput, {\n            rows: 1,\n            onChange: onChangeReComment\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 377,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(ButtonWrapper, {\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"submit-btn\",\n              onClick: onReCommentSubmit,\n              children: \"\\uB4F1\\uB85D\"\n            }, \"comment-list-reply-to-0\", false, {\n              fileName: _jsxFileName,\n              lineNumber: 379,\n              columnNumber: 23\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"cancel-btn\",\n              onClick: onChangeApplyToggle,\n              children: \"\\uCDE8\\uC18C\"\n            }, \"comment-list-reply-to-1\", false, {\n              fileName: _jsxFileName,\n              lineNumber: 386,\n              columnNumber: 23\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"secret-btn\",\n              children: /*#__PURE__*/_jsxDEV(Checkbox, {\n                onChange: onToggleIsSecret,\n                style: {\n                  color: \"#999\"\n                },\n                children: \"\\uBE44\\uBC00 \\uB313\\uAE00\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 397,\n                columnNumber: 25\n              }, this)\n            }, \"comment-list-reply-to-2\", false, {\n              fileName: _jsxFileName,\n              lineNumber: 393,\n              columnNumber: 23\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 378,\n            columnNumber: 21\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 376,\n          columnNumber: 19\n        }, this)\n      }, void 0, false)]),\n      author: !item.isDelete && item.writer && post.writer && (item.writer._id === post.writer._id ? /*#__PURE__*/_jsxDEV(\"span\", {\n        style: {\n          color: \"#1a91fe\"\n        },\n        children: \"\\uAE00\\uC4F4\\uC774\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 414,\n        columnNumber: 13\n      }, this) : item.writer.nickname),\n      avatar: /*#__PURE__*/_jsxDEV(Popover, {\n        content: /*#__PURE__*/_jsxDEV(\"div\", {\n          onClick: e => {\n            e.stopPropagation();\n          },\n          children: item.writer && !item.isDelete && item.writer.constructor == Object && /*#__PURE__*/_jsxDEV(ProfileModal, {\n            writer: item.writer\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 430,\n            columnNumber: 21\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 422,\n          columnNumber: 15\n        }, this),\n        children: [/*#__PURE__*/_jsxDEV(Avatar, {\n          onClick: e => {\n            e.stopPropagation();\n          },\n          style: {\n            cursor: \"pointer\"\n          },\n          size: 28,\n          icon: /*#__PURE__*/_jsxDEV(UserOutlined, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 441,\n            columnNumber: 21\n          }, this),\n          src: !item.isDelete && item.writer && item.writer.avatarUrl && /*#__PURE__*/_jsxDEV(Image, {\n            src: `${SERVER_URL}/${item.writer.avatarUrl}`,\n            width: 28,\n            height: 28\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 446,\n            columnNumber: 19\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 435,\n          columnNumber: 13\n        }, this), \" \"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 420,\n        columnNumber: 11\n      }, this),\n      content: item.writer && item.writer.constructor == Object ? item.secretComment ? me && (post.writer && me._id === post.writer._id || item.writer._id === me._id) ? /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          children: item.content\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 463,\n          columnNumber: 19\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          style: {\n            color: \"#999\",\n            fontSize: \"12px\"\n          },\n          children: [/*#__PURE__*/_jsxDEV(LockOutlined, {\n            style: {\n              margin: \"0 5px\",\n              color: \"#999\"\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 465,\n            columnNumber: 21\n          }, this), \"\\uBE44\\uBC00 \\uB313\\uAE00\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 464,\n          columnNumber: 19\n        }, this)]\n      }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(LockOutlined, {\n          style: {\n            margin: \"0 5px\",\n            color: \"#999\"\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 471,\n          columnNumber: 19\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          style: {\n            color: \"#999\"\n          },\n          children: \"\\uBE44\\uBC00 \\uB313\\uAE00\\uC785\\uB2C8\\uB2E4.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 472,\n          columnNumber: 19\n        }, this)]\n      }, void 0, true) : item.content : \"탈퇴한 회원입니다.\",\n      datetime: `${new Date(item.createdAt).getMonth() + 1}/${new Date(item.createdAt).getDate()}  ${new Date(item.createdAt).getHours()}:${new Date(item.createdAt).getMinutes() < 10 ? \"0\" + new Date(item.createdAt).getMinutes() : new Date(item.createdAt).getMinutes()}:${new Date(item.createdAt).getSeconds() < 10 ? \"0\" + new Date(item.createdAt).getSeconds() : new Date(item.createdAt).getSeconds()}`,\n      children: post.comments.map((reComment, i) => {\n        if (reComment.commentTo === item._id) {\n          return /*#__PURE__*/_jsxDEV(ReCommentListItem, {\n            reComment: reComment,\n            post: post,\n            me: me,\n            onDeleteComment: onDeleteComment\n          }, reComment._id, false, {\n            fileName: _jsxFileName,\n            lineNumber: 497,\n            columnNumber: 15\n          }, this);\n        }\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 266,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 265,\n    columnNumber: 5\n  }, this);\n};\n\nexport default CommentListItem;","map":{"version":3,"sources":["/Users/jinho/Project/ProjectFrontend/components/common/contents/CommentListItem.jsx"],"names":["React","useCallback","useState","useEffect","styled","Avatar","Popover","Comment","Input","Image","Checkbox","ProfileModal","UserOutlined","LockOutlined","LikeOutlined","LikeFilled","useSelector","useDispatch","useToggle","SERVER_URL","addCommentRequestAction","deleteCommentRequestAction","likeCommentRequestAction","unLikeCommentRequestAction","useInput","Router","axios","ReCommentListItem","ReApplyFormWrapper","div","ReApplyInput","TextArea","ButtonWrapper","CommentActivityWrapper","CommentListItem","item","post","me","state","user","dispatch","reComment","onChangeReComment","editCommentText","setEditCommentText","isSecret","onToggleIsSecret","isEdit","onToggleIsEdit","isEditSecret","setIsEditSecret","applyToggle","onChangeApplyToggle","like","setLike","likes","some","v","i","userId","_id","onChangeEditCommentText","e","target","value","onToggleIsEditSecret","onToggleLike","id","find","type","commentId","onCancelEdit","content","secretComment","onReCommentSubmit","alert","submitConfirm","confirm","postId","commentTo","then","res","push","catch","err","console","log","onUpdateComment","comment","updateConfirm","patch","error","onDeleteComment","confirmDelete","flag","parentId","comments","forEach","put","child","parent","childInParentLength","isDelete","delete","color","marginRight","length","writer","nickname","stopPropagation","constructor","Object","cursor","avatarUrl","fontSize","margin","Date","createdAt","getMonth","getDate","getHours","getMinutes","getSeconds","map"],"mappings":"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","sourcesContent":["import React, { useCallback, useState, useEffect } from \"react\";\nimport styled from \"styled-components\";\nimport { Avatar, Popover, Comment, Input, Image, Checkbox } from \"antd\";\nimport ProfileModal from \"../../modal/ProfileModal\";\nimport {\n  UserOutlined,\n  LockOutlined,\n  LikeOutlined,\n  LikeFilled,\n} from \"@ant-design/icons\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport useToggle from \"../../../hooks/useToggle\";\nimport { SERVER_URL } from \"../../../lib/constant/constant\";\nimport {\n  addCommentRequestAction,\n  deleteCommentRequestAction,\n  likeCommentRequestAction,\n  unLikeCommentRequestAction,\n} from \"../../../reducers/post\";\nimport useInput from \"../../../hooks/useInput\";\nimport Router from \"next/router\";\nimport axios from \"axios\";\nimport ReCommentListItem from \"./ReCommentListItem\";\n\n/**\n * @author 박진호\n * @version 1.0\n * @summary 댓글 리스트 아이템 컴포넌트\n */\n\n// style\n\nconst ReApplyFormWrapper = styled.div`\n  width: 800px;\n  display: flex;\n  @media (max-width: 768px) {\n    width: 200px;\n    display: block;\n  }\n`;\n\nconst ReApplyInput = styled(Input.TextArea)`\n  flex: 7;\n`;\n\nconst ButtonWrapper = styled.div`\n  line-height: 30px;\n  flex: 1;\n  .cancel-btn {\n    cursor: pointer;\n    margin-left: 5px;\n  }\n  .submit-btn {\n    cursor: pointer;\n    color: #208fff;\n    margin-left: 10px;\n  }\n  .secret-btn {\n    margin-left: 10px;\n  }\n`;\n\nconst CommentActivityWrapper = styled.div`\n  font-size: 11px;\n  padding: 0 3px;\n  cursor: pointer;\n`;\n\nconst CommentListItem = ({ item, post }) => {\n  // redux\n\n  const { me } = useSelector((state) => state.user);\n  const dispatch = useDispatch();\n\n  // local state\n  const [reComment, onChangeReComment] = useInput(\"\");\n  const [editCommentText, setEditCommentText] = useState(\"\");\n  const [isSecret, onToggleIsSecret] = useToggle(false);\n  const [isEdit, onToggleIsEdit] = useToggle(false);\n  const [isEditSecret, setIsEditSecret] = useState(false);\n  const [applyToggle, onChangeApplyToggle] = useToggle(false);\n  const [like, setLike] = useState(\n    item.likes.some((v, i) => {\n      if (me && v.userId === me._id) {\n        return true;\n      }\n    })\n      ? true\n      : false,\n  );\n\n  // event listener\n\n  const onChangeEditCommentText = useCallback((e) => {\n    setEditCommentText(e.target.value);\n  }, []);\n\n  const onToggleIsEditSecret = useCallback(() => {\n    setIsEditSecret(!isEditSecret);\n  }, [isEditSecret]);\n\n  const onToggleLike = useCallback(() => {\n    setLike(!like);\n    if (like) {\n      dispatch(\n        unLikeCommentRequestAction({\n          user: me,\n          id: item.likes.find((v, i) => {\n            if (v.userId === me._id) {\n              return true;\n            }\n          })._id,\n          type: \"comment\",\n          commentId: item._id,\n        }),\n      );\n    } else {\n      dispatch(\n        likeCommentRequestAction({\n          user: me,\n          id: item._id,\n          type: \"comment\",\n        }),\n      );\n    }\n  }, [like, me, item]);\n\n  const onCancelEdit = useCallback(() => {\n    setEditCommentText(item.content);\n    setIsEditSecret(item.secretComment);\n    onToggleIsEdit();\n  }, [item, isEdit]);\n\n  const onReCommentSubmit = useCallback(async () => {\n    if (reComment === \"\") {\n      alert(\"내용을 입력해주세요.\");\n      return;\n    }\n    let submitConfirm = confirm(\"댓글을 등록하시겠습니까?\");\n    if (submitConfirm) {\n      await axios\n        .post(`/api/comments`, {\n          postId: post._id,\n          type: post.type,\n          content: reComment,\n          commentTo: item._id,\n          secretComment: isSecret,\n        })\n        .then((res) => {\n          onChangeApplyToggle();\n          Router.push(`/articles/${post.type}/${post._id}`);\n        })\n        .catch((err) => {\n          console.log(err);\n        });\n    } else {\n      return;\n    }\n  }, [post, item, reComment, isSecret]);\n\n  const onUpdateComment = useCallback(\n    (comment) => {\n      if (editCommentText === \"\") {\n        alert(\"내용을 입력해주세요.\");\n        return;\n      }\n      let updateConfirm = confirm(\"수정하시겠습니까?\");\n      if (updateConfirm) {\n        axios\n          .patch(`/api/comments`, {\n            commentId: comment._id,\n            content: editCommentText,\n            secretComment: isEditSecret,\n          })\n          .then((res) => {\n            onToggleIsEdit();\n            Router.push(`/articles/${post.type}/${post._id}`);\n          })\n          .catch((error) => {\n            alert(\"댓글수정 실패\");\n          });\n      } else {\n        return;\n      }\n    },\n    [isEditSecret, editCommentText],\n  );\n\n  const onDeleteComment = useCallback(\n    async (id) => {\n      let confirmDelete = confirm(\"정말로 삭제하시겠습니까?\");\n      if (confirmDelete) {\n        let flag = false;\n\n        let parentId = null;\n        post.comments.forEach((v, i) => {\n          if (id === v.commentTo) {\n            flag = true;\n          }\n        });\n        if (flag) {\n          await axios\n            .put(`/api/comments/parentDelete`, { id })\n            .then((res) => {\n              Router.push(`/articles/${post.type}/${post._id}`);\n            })\n            .catch((err) => {\n              console.log(err);\n            });\n        } else {\n          let child;\n          let parent;\n          let childInParentLength = 0;\n          post.comments.forEach((v, i) => {\n            if (id === v._id) {\n              child = v;\n            }\n          });\n          post.comments.forEach((v, i) => {\n            if (child.commentTo === v._id) {\n              parent = v;\n            }\n          });\n          post.comments.forEach((v, i) => {\n            if (parent && parent._id === v.commentTo) {\n              childInParentLength++;\n            }\n          });\n\n          if (parent && parent.isDelete && childInParentLength === 1) {\n            parentId = parent._id;\n\n            axios.delete(`/api/comments/${parentId}`).then(() => {\n              axios.delete(`/api/comments/${id}`).then(() => {\n                Router.push(`/articles/${post.type}/${post._id}`);\n                return;\n              });\n            });\n          } else {\n            await axios\n              .delete(`/api/comments/${id}`)\n              .then((res) => {\n                Router.push(`/articles/${post.type}/${post._id}`);\n              })\n              .catch((err) => {\n                console.log(err);\n              });\n          }\n        }\n      } else {\n        return;\n      }\n    },\n    [item, post],\n  );\n\n  // hooks\n\n  useEffect(() => {\n    setEditCommentText(item.content);\n    setIsEditSecret(item.secretComment);\n  }, [item]);\n\n  return (\n    <li>\n      <Comment\n        actions={\n          me &&\n          !item.isDelete &&\n          (!applyToggle\n            ? isEdit\n              ? [\n                  <>\n                    <ReApplyFormWrapper>\n                      <ReApplyInput\n                        rows={1}\n                        onChange={onChangeEditCommentText}\n                        defaultValue={item.content}\n                      />\n\n                      <ButtonWrapper>\n                        <span\n                          className=\"submit-btn\"\n                          key=\"comment-list-reply-to-0\"\n                          onClick={() => {\n                            onUpdateComment(item);\n                          }}\n                        >\n                          수정\n                        </span>\n                        <span\n                          className=\"cancel-btn\"\n                          key=\"comment-list-reply-to-1\"\n                          onClick={onCancelEdit}\n                        >\n                          취소\n                        </span>\n                        <span\n                          className=\"secret-btn\"\n                          key=\"comment-list-reply-to-2\"\n                        >\n                          <Checkbox\n                            onChange={onToggleIsEditSecret}\n                            style={{ color: \"#999\" }}\n                            defaultChecked={item.secretComment}\n                          >\n                            비밀 댓글\n                          </Checkbox>\n                        </span>\n                      </ButtonWrapper>\n                    </ReApplyFormWrapper>\n                  </>,\n                ]\n              : [\n                  <CommentActivityWrapper>\n                    {me && (\n                      <span\n                        style={{ marginRight: \"10px\" }}\n                        onClick={onToggleLike}\n                      >\n                        {like ? (\n                          <LikeFilled\n                            style={{ marginRight: \"3px\", color: \"#1a91fe\" }}\n                          />\n                        ) : (\n                          <LikeOutlined style={{ marginRight: \"3px\" }} />\n                        )}\n\n                        {item.likes.length}\n                      </span>\n                    )}\n                  </CommentActivityWrapper>,\n                  <CommentActivityWrapper\n                    key=\"comment-list-reply-to-0\"\n                    onClick={onChangeApplyToggle}\n                  >\n                    대댓글 쓰기\n                  </CommentActivityWrapper>,\n                  <CommentActivityWrapper>\n                    {item.writer && me._id === item.writer._id && (\n                      <span>|</span>\n                    )}\n                  </CommentActivityWrapper>,\n                  <CommentActivityWrapper>\n                    {item.writer && me._id === item.writer._id && (\n                      <span\n                        key=\"comment-list-reply-to-0\"\n                        onClick={() => {\n                          onDeleteComment(item._id);\n                        }}\n                      >\n                        삭제\n                      </span>\n                    )}\n                  </CommentActivityWrapper>,\n                  <CommentActivityWrapper>\n                    {item.writer && me._id === item.writer._id && (\n                      <span>|</span>\n                    )}\n                  </CommentActivityWrapper>,\n                  <CommentActivityWrapper>\n                    {item.writer && me._id === item.writer._id && (\n                      <span\n                        key=\"comment-list-reply-to-0\"\n                        onClick={onToggleIsEdit}\n                      >\n                        수정\n                      </span>\n                    )}\n                  </CommentActivityWrapper>,\n\n                  ,\n                ]\n            : [\n                <>\n                  <ReApplyFormWrapper>\n                    <ReApplyInput rows={1} onChange={onChangeReComment} />\n                    <ButtonWrapper>\n                      <span\n                        className=\"submit-btn\"\n                        key=\"comment-list-reply-to-0\"\n                        onClick={onReCommentSubmit}\n                      >\n                        등록\n                      </span>\n                      <span\n                        className=\"cancel-btn\"\n                        key=\"comment-list-reply-to-1\"\n                        onClick={onChangeApplyToggle}\n                      >\n                        취소\n                      </span>\n                      <span\n                        className=\"secret-btn\"\n                        key=\"comment-list-reply-to-2\"\n                      >\n                        <Checkbox\n                          onChange={onToggleIsSecret}\n                          style={{ color: \"#999\" }}\n                        >\n                          비밀 댓글\n                        </Checkbox>\n                      </span>\n                    </ButtonWrapper>\n                  </ReApplyFormWrapper>\n                </>,\n              ])\n        }\n        author={\n          !item.isDelete &&\n          item.writer &&\n          post.writer &&\n          (item.writer._id === post.writer._id ? (\n            <span style={{ color: \"#1a91fe\" }}>글쓴이</span>\n          ) : (\n            item.writer.nickname\n          ))\n        }\n        avatar={\n          <Popover\n            content={\n              <div\n                onClick={(e) => {\n                  e.stopPropagation();\n                }}\n              >\n                {item.writer &&\n                  !item.isDelete &&\n                  item.writer.constructor == Object && (\n                    <ProfileModal writer={item.writer}></ProfileModal>\n                  )}\n              </div>\n            }\n          >\n            <Avatar\n              onClick={(e) => {\n                e.stopPropagation();\n              }}\n              style={{ cursor: \"pointer\" }}\n              size={28}\n              icon={<UserOutlined />}\n              src={\n                !item.isDelete &&\n                item.writer &&\n                item.writer.avatarUrl && (\n                  <Image\n                    src={`${SERVER_URL}/${item.writer.avatarUrl}`}\n                    width={28}\n                    height={28}\n                  />\n                )\n              }\n            />{\" \"}\n          </Popover>\n        }\n        content={\n          item.writer && item.writer.constructor == Object ? (\n            item.secretComment ? (\n              me &&\n              ((post.writer && me._id === post.writer._id) ||\n                item.writer._id === me._id) ? (\n                <>\n                  <span>{item.content}</span>\n                  <span style={{ color: \"#999\", fontSize: \"12px\" }}>\n                    <LockOutlined style={{ margin: \"0 5px\", color: \"#999\" }} />\n                    비밀 댓글\n                  </span>\n                </>\n              ) : (\n                <>\n                  <LockOutlined style={{ margin: \"0 5px\", color: \"#999\" }} />\n                  <span style={{ color: \"#999\" }}>비밀 댓글입니다.</span>\n                </>\n              )\n            ) : (\n              item.content\n            )\n          ) : (\n            \"탈퇴한 회원입니다.\"\n          )\n        }\n        datetime={`${new Date(item.createdAt).getMonth() + 1}/${new Date(\n          item.createdAt,\n        ).getDate()}  ${new Date(item.createdAt).getHours()}:${\n          new Date(item.createdAt).getMinutes() < 10\n            ? \"0\" + new Date(item.createdAt).getMinutes()\n            : new Date(item.createdAt).getMinutes()\n        }:${\n          new Date(item.createdAt).getSeconds() < 10\n            ? \"0\" + new Date(item.createdAt).getSeconds()\n            : new Date(item.createdAt).getSeconds()\n        }`}\n      >\n        {post.comments.map((reComment, i) => {\n          if (reComment.commentTo === item._id) {\n            return (\n              <ReCommentListItem\n                key={reComment._id}\n                reComment={reComment}\n                post={post}\n                me={me}\n                onDeleteComment={onDeleteComment}\n              />\n            );\n          }\n        })}\n      </Comment>\n    </li>\n  );\n};\n\nexport default CommentListItem;\n"]},"metadata":{},"sourceType":"module"}