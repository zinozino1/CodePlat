{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"/Users/jinho/Project/ProjectFrontend/components/common/contents/CommentListItem.jsx\",\n    _this = this,\n    _s = $RefreshSig$();\n\nimport React, { useCallback, useState, useEffect } from \"react\";\nimport styled from \"styled-components\";\nimport { Avatar, Popover, Comment, Input, Image, Checkbox } from \"antd\";\nimport ProfileModal from \"../../modal/ProfileModal\";\nimport { UserOutlined, LockOutlined, LikeOutlined, LikeFilled } from \"@ant-design/icons\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport useToggle from \"../../../hooks/useToggle\";\nimport { SERVER_URL } from \"../../../lib/constant/constant\";\nimport { addCommentRequestAction, deleteCommentRequestAction, likeCommentRequestAction, unLikeCommentRequestAction } from \"../../../reducers/post\";\nimport useInput from \"../../../hooks/useInput\";\nimport Router from \"next/router\";\nimport axios from \"axios\";\nimport ReCommentListItem from \"./ReCommentListItem\";\n/**\n * @author 박진호\n * @version 1.0\n * @summary 댓글 리스트 아이템 컴포넌트\n */\n// style\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nvar ReApplyFormWrapper = styled.div.withConfig({\n  displayName: \"CommentListItem__ReApplyFormWrapper\",\n  componentId: \"ugl3jc-0\"\n})([\"width:800px;display:flex;@media (max-width:768px){width:200px;display:block;}\"]);\n_c = ReApplyFormWrapper;\nvar ReApplyInput = styled(Input.TextArea).withConfig({\n  displayName: \"CommentListItem__ReApplyInput\",\n  componentId: \"ugl3jc-1\"\n})([\"flex:7;\"]);\n_c2 = ReApplyInput;\nvar ButtonWrapper = styled.div.withConfig({\n  displayName: \"CommentListItem__ButtonWrapper\",\n  componentId: \"ugl3jc-2\"\n})([\"line-height:30px;flex:1;.cancel-btn{cursor:pointer;margin-left:5px;}.submit-btn{cursor:pointer;color:#208fff;margin-left:10px;}.secret-btn{margin-left:10px;}\"]);\n_c3 = ButtonWrapper;\nvar CommentActivityWrapper = styled.div.withConfig({\n  displayName: \"CommentListItem__CommentActivityWrapper\",\n  componentId: \"ugl3jc-3\"\n})([\"font-size:11px;padding:0 3px;cursor:pointer;\"]);\n_c4 = CommentActivityWrapper;\n\nvar CommentListItem = function CommentListItem(_ref) {\n  _s();\n\n  var item = _ref.item,\n      post = _ref.post;\n\n  // redux\n  var _useSelector = useSelector(function (state) {\n    return state.user;\n  }),\n      me = _useSelector.me;\n\n  var dispatch = useDispatch(); // local state\n\n  var _useInput = useInput(\"\"),\n      _useInput2 = _slicedToArray(_useInput, 2),\n      reComment = _useInput2[0],\n      onChangeReComment = _useInput2[1];\n\n  var _useState = useState(\"\"),\n      editCommentText = _useState[0],\n      setEditCommentText = _useState[1];\n\n  var _useToggle = useToggle(false),\n      _useToggle2 = _slicedToArray(_useToggle, 2),\n      isSecret = _useToggle2[0],\n      onToggleIsSecret = _useToggle2[1];\n\n  var _useToggle3 = useToggle(false),\n      _useToggle4 = _slicedToArray(_useToggle3, 2),\n      isEdit = _useToggle4[0],\n      onToggleIsEdit = _useToggle4[1];\n\n  var _useState2 = useState(false),\n      isEditSecret = _useState2[0],\n      setIsEditSecret = _useState2[1];\n\n  var _useToggle5 = useToggle(false),\n      _useToggle6 = _slicedToArray(_useToggle5, 2),\n      applyToggle = _useToggle6[0],\n      onChangeApplyToggle = _useToggle6[1];\n\n  var _useState3 = useState(item.likes.some(function (v, i) {\n    if (me && v.userId === me._id) {\n      return true;\n    }\n  }) ? true : false),\n      like = _useState3[0],\n      setLike = _useState3[1]; // event listener\n\n\n  var onChangeEditCommentText = useCallback(function (e) {\n    setEditCommentText(e.target.value);\n  }, []);\n  var onToggleIsEditSecret = useCallback(function () {\n    setIsEditSecret(!isEditSecret);\n  }, [isEditSecret]);\n  var onToggleLike = useCallback(function () {\n    setLike(!like);\n\n    if (like) {\n      dispatch(unLikeCommentRequestAction({\n        user: me,\n        id: item.likes.find(function (v, i) {\n          if (v.userId === me._id) {\n            return true;\n          }\n        })._id,\n        type: \"comment\",\n        commentId: item._id\n      }));\n    } else {\n      dispatch(likeCommentRequestAction({\n        user: me,\n        id: item._id,\n        type: \"comment\"\n      }));\n    }\n  }, [like, me, item]);\n  var onCancelEdit = useCallback(function () {\n    setEditCommentText(item.content);\n    setIsEditSecret(item.secretComment);\n    onToggleIsEdit();\n  }, [item, isEdit]);\n  var onReCommentSubmit = useCallback(function () {\n    if (reComment === \"\") {\n      alert(\"내용을 입력해주세요.\");\n      return;\n    }\n\n    var submitConfirm = confirm(\"댓글을 등록하시겠습니까?\");\n\n    if (submitConfirm) {\n      dispatch(addCommentRequestAction({\n        postId: post._id,\n        type: post.type,\n        content: reComment,\n        commentTo: item._id,\n        secretComment: isSecret\n      }));\n      Router.push(\"/articles/\".concat(post.type, \"/\").concat(post._id));\n    } else {\n      return;\n    }\n  }, [post, item, reComment, isSecret]);\n  var onUpdateComment = useCallback(function (comment) {\n    if (editCommentText === \"\") {\n      alert(\"내용을 입력해주세요.\");\n      return;\n    }\n\n    var updateConfirm = confirm(\"수정하시겠습니까?\");\n\n    if (updateConfirm) {\n      axios.patch(\"/api/comments\", {\n        commentId: comment._id,\n        content: editCommentText,\n        secretComment: isEditSecret\n      }).then(function (res) {\n        onToggleIsEdit();\n        Router.push(\"/articles/\".concat(post.type, \"/\").concat(post._id));\n      })[\"catch\"](function (error) {\n        alert(\"댓글수정 실패\");\n      });\n    } else {\n      return;\n    }\n  }, [isEditSecret, editCommentText]);\n  var onDeleteComment = useCallback(function (id) {\n    var confirmDelete = confirm(\"정말로 삭제하시겠습니까?\");\n\n    if (confirmDelete) {\n      var flag = false;\n      var parentId = null;\n      post.comments.forEach(function (v, i) {\n        if (id === v.commentTo) {\n          flag = true;\n        }\n      });\n\n      if (flag) {\n        dispatch(deleteCommentRequestAction({\n          type: \"children\",\n          id: id\n        }));\n      } else {\n        var child;\n        var parent;\n        var childInParentLength = 0;\n        post.comments.forEach(function (v, i) {\n          if (id === v._id) {\n            child = v;\n          }\n        });\n        post.comments.forEach(function (v, i) {\n          if (child.commentTo === v._id) {\n            parent = v;\n          }\n        });\n        post.comments.forEach(function (v, i) {\n          if (parent && parent._id === v.commentTo) {\n            childInParentLength++;\n          }\n        });\n\n        if (parent && parent.isDelete && childInParentLength === 1) {\n          parentId = parent._id;\n          axios[\"delete\"](\"/api/comments/\".concat(parentId)).then(function () {\n            axios[\"delete\"](\"/api/comments/\".concat(id)).then(function () {\n              Router.push(\"/articles/\".concat(post.type, \"/\").concat(post._id));\n              return;\n            });\n          });\n        } else {\n          dispatch(deleteCommentRequestAction({\n            type: \"none\",\n            id: id\n          }));\n        }\n      }\n\n      Router.push(\"/articles/\".concat(post.type, \"/\").concat(post._id));\n    } else {\n      return;\n    }\n  }, [item, post]); // hooks\n\n  useEffect(function () {\n    setEditCommentText(item.content);\n    setIsEditSecret(item.secretComment);\n  }, [item]);\n  return /*#__PURE__*/_jsxDEV(\"li\", {\n    children: /*#__PURE__*/_jsxDEV(Comment, {\n      actions: me && !item.isDelete && (!applyToggle ? isEdit ? [/*#__PURE__*/_jsxDEV(_Fragment, {\n        children: /*#__PURE__*/_jsxDEV(ReApplyFormWrapper, {\n          children: [/*#__PURE__*/_jsxDEV(ReApplyInput, {\n            rows: 1,\n            onChange: onChangeEditCommentText,\n            defaultValue: item.content\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 258,\n            columnNumber: 23\n          }, _this), /*#__PURE__*/_jsxDEV(ButtonWrapper, {\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"submit-btn\",\n              onClick: function onClick() {\n                onUpdateComment(item);\n              },\n              children: \"\\uC218\\uC815\"\n            }, \"comment-list-reply-to-0\", false, {\n              fileName: _jsxFileName,\n              lineNumber: 265,\n              columnNumber: 25\n            }, _this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"cancel-btn\",\n              onClick: onCancelEdit,\n              children: \"\\uCDE8\\uC18C\"\n            }, \"comment-list-reply-to-1\", false, {\n              fileName: _jsxFileName,\n              lineNumber: 274,\n              columnNumber: 25\n            }, _this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"secret-btn\",\n              children: /*#__PURE__*/_jsxDEV(Checkbox, {\n                onChange: onToggleIsEditSecret,\n                style: {\n                  color: \"#999\"\n                },\n                defaultChecked: item.secretComment,\n                children: \"\\uBE44\\uBC00 \\uB313\\uAE00\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 285,\n                columnNumber: 27\n              }, _this)\n            }, \"comment-list-reply-to-2\", false, {\n              fileName: _jsxFileName,\n              lineNumber: 281,\n              columnNumber: 25\n            }, _this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 264,\n            columnNumber: 23\n          }, _this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 257,\n          columnNumber: 21\n        }, _this)\n      }, void 0, false)] : [/*#__PURE__*/_jsxDEV(CommentActivityWrapper, {\n        children: me && /*#__PURE__*/_jsxDEV(\"span\", {\n          style: {\n            marginRight: \"10px\"\n          },\n          onClick: onToggleLike,\n          children: [like ? /*#__PURE__*/_jsxDEV(LikeFilled, {\n            style: {\n              marginRight: \"3px\",\n              color: \"#1a91fe\"\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 305,\n            columnNumber: 27\n          }, _this) : /*#__PURE__*/_jsxDEV(LikeOutlined, {\n            style: {\n              marginRight: \"3px\"\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 309,\n            columnNumber: 27\n          }, _this), item.likes.length]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 300,\n          columnNumber: 23\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 298,\n        columnNumber: 19\n      }, _this), /*#__PURE__*/_jsxDEV(CommentActivityWrapper, {\n        onClick: onChangeApplyToggle,\n        children: \"\\uB300\\uB313\\uAE00 \\uC4F0\\uAE30\"\n      }, \"comment-list-reply-to-0\", false, {\n        fileName: _jsxFileName,\n        lineNumber: 316,\n        columnNumber: 19\n      }, _this), /*#__PURE__*/_jsxDEV(CommentActivityWrapper, {\n        children: item.writer && me._id === item.writer._id && /*#__PURE__*/_jsxDEV(\"span\", {\n          children: \"|\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 324,\n          columnNumber: 23\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 322,\n        columnNumber: 19\n      }, _this), /*#__PURE__*/_jsxDEV(CommentActivityWrapper, {\n        children: item.writer && me._id === item.writer._id && /*#__PURE__*/_jsxDEV(\"span\", {\n          onClick: function onClick() {\n            onDeleteComment(item._id);\n          },\n          children: \"\\uC0AD\\uC81C\"\n        }, \"comment-list-reply-to-0\", false, {\n          fileName: _jsxFileName,\n          lineNumber: 329,\n          columnNumber: 23\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 327,\n        columnNumber: 19\n      }, _this), /*#__PURE__*/_jsxDEV(CommentActivityWrapper, {\n        children: item.writer && me._id === item.writer._id && /*#__PURE__*/_jsxDEV(\"span\", {\n          children: \"|\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 341,\n          columnNumber: 23\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 339,\n        columnNumber: 19\n      }, _this), /*#__PURE__*/_jsxDEV(CommentActivityWrapper, {\n        children: item.writer && me._id === item.writer._id && /*#__PURE__*/_jsxDEV(\"span\", {\n          onClick: onToggleIsEdit,\n          children: \"\\uC218\\uC815\"\n        }, \"comment-list-reply-to-0\", false, {\n          fileName: _jsxFileName,\n          lineNumber: 346,\n          columnNumber: 23\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 344,\n        columnNumber: 19\n      }, _this),,] : [/*#__PURE__*/_jsxDEV(_Fragment, {\n        children: /*#__PURE__*/_jsxDEV(ReApplyFormWrapper, {\n          children: [/*#__PURE__*/_jsxDEV(ReApplyInput, {\n            rows: 1,\n            onChange: onChangeReComment\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 360,\n            columnNumber: 21\n          }, _this), /*#__PURE__*/_jsxDEV(ButtonWrapper, {\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"submit-btn\",\n              onClick: onReCommentSubmit,\n              children: \"\\uB4F1\\uB85D\"\n            }, \"comment-list-reply-to-0\", false, {\n              fileName: _jsxFileName,\n              lineNumber: 362,\n              columnNumber: 23\n            }, _this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"cancel-btn\",\n              onClick: onChangeApplyToggle,\n              children: \"\\uCDE8\\uC18C\"\n            }, \"comment-list-reply-to-1\", false, {\n              fileName: _jsxFileName,\n              lineNumber: 369,\n              columnNumber: 23\n            }, _this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"secret-btn\",\n              children: /*#__PURE__*/_jsxDEV(Checkbox, {\n                onChange: onToggleIsSecret,\n                style: {\n                  color: \"#999\"\n                },\n                children: \"\\uBE44\\uBC00 \\uB313\\uAE00\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 380,\n                columnNumber: 25\n              }, _this)\n            }, \"comment-list-reply-to-2\", false, {\n              fileName: _jsxFileName,\n              lineNumber: 376,\n              columnNumber: 23\n            }, _this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 361,\n            columnNumber: 21\n          }, _this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 359,\n          columnNumber: 19\n        }, _this)\n      }, void 0, false)]),\n      author: !item.isDelete && item.writer && post.writer && (item.writer._id === post.writer._id ? /*#__PURE__*/_jsxDEV(\"span\", {\n        style: {\n          color: \"#1a91fe\"\n        },\n        children: \"\\uAE00\\uC4F4\\uC774\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 397,\n        columnNumber: 13\n      }, _this) : item.writer.nickname),\n      avatar: /*#__PURE__*/_jsxDEV(Popover, {\n        content: /*#__PURE__*/_jsxDEV(\"div\", {\n          onClick: function onClick(e) {\n            e.stopPropagation();\n          },\n          children: item.writer && !item.isDelete && item.writer.constructor == Object && /*#__PURE__*/_jsxDEV(ProfileModal, {\n            writer: item.writer\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 413,\n            columnNumber: 21\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 405,\n          columnNumber: 15\n        }, _this),\n        children: [/*#__PURE__*/_jsxDEV(Avatar, {\n          onClick: function onClick(e) {\n            e.stopPropagation();\n          },\n          style: {\n            cursor: \"pointer\"\n          },\n          size: 28,\n          icon: /*#__PURE__*/_jsxDEV(UserOutlined, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 424,\n            columnNumber: 21\n          }, _this),\n          src: !item.isDelete && item.writer && item.writer.avatarUrl && /*#__PURE__*/_jsxDEV(Image, {\n            src: \"\".concat(SERVER_URL, \"/\").concat(item.writer.avatarUrl),\n            width: 28,\n            height: 28\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 429,\n            columnNumber: 19\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 418,\n          columnNumber: 13\n        }, _this), \" \"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 403,\n        columnNumber: 11\n      }, _this),\n      content: item.writer && item.writer.constructor == Object ? item.secretComment ? me && (post.writer && me._id === post.writer._id || item.writer._id === me._id) ? /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          children: item.content\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 446,\n          columnNumber: 19\n        }, _this), /*#__PURE__*/_jsxDEV(\"span\", {\n          style: {\n            color: \"#999\",\n            fontSize: \"12px\"\n          },\n          children: [/*#__PURE__*/_jsxDEV(LockOutlined, {\n            style: {\n              margin: \"0 5px\",\n              color: \"#999\"\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 448,\n            columnNumber: 21\n          }, _this), \"\\uBE44\\uBC00 \\uB313\\uAE00\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 447,\n          columnNumber: 19\n        }, _this)]\n      }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(LockOutlined, {\n          style: {\n            margin: \"0 5px\",\n            color: \"#999\"\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 454,\n          columnNumber: 19\n        }, _this), /*#__PURE__*/_jsxDEV(\"span\", {\n          style: {\n            color: \"#999\"\n          },\n          children: \"\\uBE44\\uBC00 \\uB313\\uAE00\\uC785\\uB2C8\\uB2E4.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 455,\n          columnNumber: 19\n        }, _this)]\n      }, void 0, true) : item.content : \"탈퇴한 회원입니다.\",\n      datetime: \"\".concat(new Date(item.createdAt).getMonth() + 1, \"/\").concat(new Date(item.createdAt).getDate(), \"  \").concat(new Date(item.createdAt).getHours(), \":\").concat(new Date(item.createdAt).getMinutes() < 10 ? \"0\" + new Date(item.createdAt).getMinutes() : new Date(item.createdAt).getMinutes(), \":\").concat(new Date(item.createdAt).getSeconds() < 10 ? \"0\" + new Date(item.createdAt).getSeconds() : new Date(item.createdAt).getSeconds()),\n      children: post.comments.map(function (reComment, i) {\n        if (reComment.commentTo === item._id) {\n          return /*#__PURE__*/_jsxDEV(ReCommentListItem, {\n            reComment: reComment,\n            post: post,\n            me: me,\n            onDeleteComment: onDeleteComment\n          }, reComment._id, false, {\n            fileName: _jsxFileName,\n            lineNumber: 480,\n            columnNumber: 15\n          }, _this);\n        }\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 249,\n      columnNumber: 7\n    }, _this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 248,\n    columnNumber: 5\n  }, _this);\n};\n\n_s(CommentListItem, \"mqnxjl84x9MEXowmG89zxXpQBmY=\", false, function () {\n  return [useSelector, useDispatch, useInput, useToggle, useToggle, useToggle];\n});\n\n_c5 = CommentListItem;\nexport default CommentListItem;\n\nvar _c, _c2, _c3, _c4, _c5;\n\n$RefreshReg$(_c, \"ReApplyFormWrapper\");\n$RefreshReg$(_c2, \"ReApplyInput\");\n$RefreshReg$(_c3, \"ButtonWrapper\");\n$RefreshReg$(_c4, \"CommentActivityWrapper\");\n$RefreshReg$(_c5, \"CommentListItem\");","map":{"version":3,"sources":["/Users/jinho/Project/ProjectFrontend/components/common/contents/CommentListItem.jsx"],"names":["React","useCallback","useState","useEffect","styled","Avatar","Popover","Comment","Input","Image","Checkbox","ProfileModal","UserOutlined","LockOutlined","LikeOutlined","LikeFilled","useSelector","useDispatch","useToggle","SERVER_URL","addCommentRequestAction","deleteCommentRequestAction","likeCommentRequestAction","unLikeCommentRequestAction","useInput","Router","axios","ReCommentListItem","ReApplyFormWrapper","div","ReApplyInput","TextArea","ButtonWrapper","CommentActivityWrapper","CommentListItem","item","post","state","user","me","dispatch","reComment","onChangeReComment","editCommentText","setEditCommentText","isSecret","onToggleIsSecret","isEdit","onToggleIsEdit","isEditSecret","setIsEditSecret","applyToggle","onChangeApplyToggle","likes","some","v","i","userId","_id","like","setLike","onChangeEditCommentText","e","target","value","onToggleIsEditSecret","onToggleLike","id","find","type","commentId","onCancelEdit","content","secretComment","onReCommentSubmit","alert","submitConfirm","confirm","postId","commentTo","push","onUpdateComment","comment","updateConfirm","patch","then","res","error","onDeleteComment","confirmDelete","flag","parentId","comments","forEach","child","parent","childInParentLength","isDelete","color","marginRight","length","writer","nickname","stopPropagation","constructor","Object","cursor","avatarUrl","fontSize","margin","Date","createdAt","getMonth","getDate","getHours","getMinutes","getSeconds","map"],"mappings":"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","sourcesContent":["import React, { useCallback, useState, useEffect } from \"react\";\nimport styled from \"styled-components\";\nimport { Avatar, Popover, Comment, Input, Image, Checkbox } from \"antd\";\nimport ProfileModal from \"../../modal/ProfileModal\";\nimport {\n  UserOutlined,\n  LockOutlined,\n  LikeOutlined,\n  LikeFilled,\n} from \"@ant-design/icons\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport useToggle from \"../../../hooks/useToggle\";\nimport { SERVER_URL } from \"../../../lib/constant/constant\";\nimport {\n  addCommentRequestAction,\n  deleteCommentRequestAction,\n  likeCommentRequestAction,\n  unLikeCommentRequestAction,\n} from \"../../../reducers/post\";\nimport useInput from \"../../../hooks/useInput\";\nimport Router from \"next/router\";\nimport axios from \"axios\";\nimport ReCommentListItem from \"./ReCommentListItem\";\n\n/**\n * @author 박진호\n * @version 1.0\n * @summary 댓글 리스트 아이템 컴포넌트\n */\n\n// style\n\nconst ReApplyFormWrapper = styled.div`\n  width: 800px;\n  display: flex;\n  @media (max-width: 768px) {\n    width: 200px;\n    display: block;\n  }\n`;\n\nconst ReApplyInput = styled(Input.TextArea)`\n  flex: 7;\n`;\n\nconst ButtonWrapper = styled.div`\n  line-height: 30px;\n  flex: 1;\n  .cancel-btn {\n    cursor: pointer;\n    margin-left: 5px;\n  }\n  .submit-btn {\n    cursor: pointer;\n    color: #208fff;\n    margin-left: 10px;\n  }\n  .secret-btn {\n    margin-left: 10px;\n  }\n`;\n\nconst CommentActivityWrapper = styled.div`\n  font-size: 11px;\n  padding: 0 3px;\n  cursor: pointer;\n`;\n\nconst CommentListItem = ({ item, post }) => {\n  // redux\n\n  const { me } = useSelector((state) => state.user);\n  const dispatch = useDispatch();\n\n  // local state\n  const [reComment, onChangeReComment] = useInput(\"\");\n  const [editCommentText, setEditCommentText] = useState(\"\");\n  const [isSecret, onToggleIsSecret] = useToggle(false);\n  const [isEdit, onToggleIsEdit] = useToggle(false);\n  const [isEditSecret, setIsEditSecret] = useState(false);\n  const [applyToggle, onChangeApplyToggle] = useToggle(false);\n  const [like, setLike] = useState(\n    item.likes.some((v, i) => {\n      if (me && v.userId === me._id) {\n        return true;\n      }\n    })\n      ? true\n      : false,\n  );\n\n  // event listener\n\n  const onChangeEditCommentText = useCallback((e) => {\n    setEditCommentText(e.target.value);\n  }, []);\n\n  const onToggleIsEditSecret = useCallback(() => {\n    setIsEditSecret(!isEditSecret);\n  }, [isEditSecret]);\n\n  const onToggleLike = useCallback(() => {\n    setLike(!like);\n    if (like) {\n      dispatch(\n        unLikeCommentRequestAction({\n          user: me,\n          id: item.likes.find((v, i) => {\n            if (v.userId === me._id) {\n              return true;\n            }\n          })._id,\n          type: \"comment\",\n          commentId: item._id,\n        }),\n      );\n    } else {\n      dispatch(\n        likeCommentRequestAction({\n          user: me,\n          id: item._id,\n          type: \"comment\",\n        }),\n      );\n    }\n  }, [like, me, item]);\n\n  const onCancelEdit = useCallback(() => {\n    setEditCommentText(item.content);\n    setIsEditSecret(item.secretComment);\n    onToggleIsEdit();\n  }, [item, isEdit]);\n\n  const onReCommentSubmit = useCallback(() => {\n    if (reComment === \"\") {\n      alert(\"내용을 입력해주세요.\");\n      return;\n    }\n    let submitConfirm = confirm(\"댓글을 등록하시겠습니까?\");\n    if (submitConfirm) {\n      dispatch(\n        addCommentRequestAction({\n          postId: post._id,\n          type: post.type,\n          content: reComment,\n          commentTo: item._id,\n          secretComment: isSecret,\n        }),\n      );\n      Router.push(`/articles/${post.type}/${post._id}`);\n    } else {\n      return;\n    }\n  }, [post, item, reComment, isSecret]);\n\n  const onUpdateComment = useCallback(\n    (comment) => {\n      if (editCommentText === \"\") {\n        alert(\"내용을 입력해주세요.\");\n        return;\n      }\n      let updateConfirm = confirm(\"수정하시겠습니까?\");\n      if (updateConfirm) {\n        axios\n          .patch(`/api/comments`, {\n            commentId: comment._id,\n            content: editCommentText,\n            secretComment: isEditSecret,\n          })\n          .then((res) => {\n            onToggleIsEdit();\n            Router.push(`/articles/${post.type}/${post._id}`);\n          })\n          .catch((error) => {\n            alert(\"댓글수정 실패\");\n          });\n      } else {\n        return;\n      }\n    },\n    [isEditSecret, editCommentText],\n  );\n\n  const onDeleteComment = useCallback(\n    (id) => {\n      let confirmDelete = confirm(\"정말로 삭제하시겠습니까?\");\n      if (confirmDelete) {\n        let flag = false;\n\n        let parentId = null;\n        post.comments.forEach((v, i) => {\n          if (id === v.commentTo) {\n            flag = true;\n          }\n        });\n        if (flag) {\n          dispatch(deleteCommentRequestAction({ type: \"children\", id }));\n        } else {\n          let child;\n          let parent;\n          let childInParentLength = 0;\n          post.comments.forEach((v, i) => {\n            if (id === v._id) {\n              child = v;\n            }\n          });\n          post.comments.forEach((v, i) => {\n            if (child.commentTo === v._id) {\n              parent = v;\n            }\n          });\n          post.comments.forEach((v, i) => {\n            if (parent && parent._id === v.commentTo) {\n              childInParentLength++;\n            }\n          });\n\n          if (parent && parent.isDelete && childInParentLength === 1) {\n            parentId = parent._id;\n\n            axios.delete(`/api/comments/${parentId}`).then(() => {\n              axios.delete(`/api/comments/${id}`).then(() => {\n                Router.push(`/articles/${post.type}/${post._id}`);\n                return;\n              });\n            });\n          } else {\n            dispatch(deleteCommentRequestAction({ type: \"none\", id }));\n          }\n        }\n\n        Router.push(`/articles/${post.type}/${post._id}`);\n      } else {\n        return;\n      }\n    },\n    [item, post],\n  );\n\n  // hooks\n\n  useEffect(() => {\n    setEditCommentText(item.content);\n    setIsEditSecret(item.secretComment);\n  }, [item]);\n\n  return (\n    <li>\n      <Comment\n        actions={\n          me &&\n          !item.isDelete &&\n          (!applyToggle\n            ? isEdit\n              ? [\n                  <>\n                    <ReApplyFormWrapper>\n                      <ReApplyInput\n                        rows={1}\n                        onChange={onChangeEditCommentText}\n                        defaultValue={item.content}\n                      />\n\n                      <ButtonWrapper>\n                        <span\n                          className=\"submit-btn\"\n                          key=\"comment-list-reply-to-0\"\n                          onClick={() => {\n                            onUpdateComment(item);\n                          }}\n                        >\n                          수정\n                        </span>\n                        <span\n                          className=\"cancel-btn\"\n                          key=\"comment-list-reply-to-1\"\n                          onClick={onCancelEdit}\n                        >\n                          취소\n                        </span>\n                        <span\n                          className=\"secret-btn\"\n                          key=\"comment-list-reply-to-2\"\n                        >\n                          <Checkbox\n                            onChange={onToggleIsEditSecret}\n                            style={{ color: \"#999\" }}\n                            defaultChecked={item.secretComment}\n                          >\n                            비밀 댓글\n                          </Checkbox>\n                        </span>\n                      </ButtonWrapper>\n                    </ReApplyFormWrapper>\n                  </>,\n                ]\n              : [\n                  <CommentActivityWrapper>\n                    {me && (\n                      <span\n                        style={{ marginRight: \"10px\" }}\n                        onClick={onToggleLike}\n                      >\n                        {like ? (\n                          <LikeFilled\n                            style={{ marginRight: \"3px\", color: \"#1a91fe\" }}\n                          />\n                        ) : (\n                          <LikeOutlined style={{ marginRight: \"3px\" }} />\n                        )}\n\n                        {item.likes.length}\n                      </span>\n                    )}\n                  </CommentActivityWrapper>,\n                  <CommentActivityWrapper\n                    key=\"comment-list-reply-to-0\"\n                    onClick={onChangeApplyToggle}\n                  >\n                    대댓글 쓰기\n                  </CommentActivityWrapper>,\n                  <CommentActivityWrapper>\n                    {item.writer && me._id === item.writer._id && (\n                      <span>|</span>\n                    )}\n                  </CommentActivityWrapper>,\n                  <CommentActivityWrapper>\n                    {item.writer && me._id === item.writer._id && (\n                      <span\n                        key=\"comment-list-reply-to-0\"\n                        onClick={() => {\n                          onDeleteComment(item._id);\n                        }}\n                      >\n                        삭제\n                      </span>\n                    )}\n                  </CommentActivityWrapper>,\n                  <CommentActivityWrapper>\n                    {item.writer && me._id === item.writer._id && (\n                      <span>|</span>\n                    )}\n                  </CommentActivityWrapper>,\n                  <CommentActivityWrapper>\n                    {item.writer && me._id === item.writer._id && (\n                      <span\n                        key=\"comment-list-reply-to-0\"\n                        onClick={onToggleIsEdit}\n                      >\n                        수정\n                      </span>\n                    )}\n                  </CommentActivityWrapper>,\n\n                  ,\n                ]\n            : [\n                <>\n                  <ReApplyFormWrapper>\n                    <ReApplyInput rows={1} onChange={onChangeReComment} />\n                    <ButtonWrapper>\n                      <span\n                        className=\"submit-btn\"\n                        key=\"comment-list-reply-to-0\"\n                        onClick={onReCommentSubmit}\n                      >\n                        등록\n                      </span>\n                      <span\n                        className=\"cancel-btn\"\n                        key=\"comment-list-reply-to-1\"\n                        onClick={onChangeApplyToggle}\n                      >\n                        취소\n                      </span>\n                      <span\n                        className=\"secret-btn\"\n                        key=\"comment-list-reply-to-2\"\n                      >\n                        <Checkbox\n                          onChange={onToggleIsSecret}\n                          style={{ color: \"#999\" }}\n                        >\n                          비밀 댓글\n                        </Checkbox>\n                      </span>\n                    </ButtonWrapper>\n                  </ReApplyFormWrapper>\n                </>,\n              ])\n        }\n        author={\n          !item.isDelete &&\n          item.writer &&\n          post.writer &&\n          (item.writer._id === post.writer._id ? (\n            <span style={{ color: \"#1a91fe\" }}>글쓴이</span>\n          ) : (\n            item.writer.nickname\n          ))\n        }\n        avatar={\n          <Popover\n            content={\n              <div\n                onClick={(e) => {\n                  e.stopPropagation();\n                }}\n              >\n                {item.writer &&\n                  !item.isDelete &&\n                  item.writer.constructor == Object && (\n                    <ProfileModal writer={item.writer}></ProfileModal>\n                  )}\n              </div>\n            }\n          >\n            <Avatar\n              onClick={(e) => {\n                e.stopPropagation();\n              }}\n              style={{ cursor: \"pointer\" }}\n              size={28}\n              icon={<UserOutlined />}\n              src={\n                !item.isDelete &&\n                item.writer &&\n                item.writer.avatarUrl && (\n                  <Image\n                    src={`${SERVER_URL}/${item.writer.avatarUrl}`}\n                    width={28}\n                    height={28}\n                  />\n                )\n              }\n            />{\" \"}\n          </Popover>\n        }\n        content={\n          item.writer && item.writer.constructor == Object ? (\n            item.secretComment ? (\n              me &&\n              ((post.writer && me._id === post.writer._id) ||\n                item.writer._id === me._id) ? (\n                <>\n                  <span>{item.content}</span>\n                  <span style={{ color: \"#999\", fontSize: \"12px\" }}>\n                    <LockOutlined style={{ margin: \"0 5px\", color: \"#999\" }} />\n                    비밀 댓글\n                  </span>\n                </>\n              ) : (\n                <>\n                  <LockOutlined style={{ margin: \"0 5px\", color: \"#999\" }} />\n                  <span style={{ color: \"#999\" }}>비밀 댓글입니다.</span>\n                </>\n              )\n            ) : (\n              item.content\n            )\n          ) : (\n            \"탈퇴한 회원입니다.\"\n          )\n        }\n        datetime={`${new Date(item.createdAt).getMonth() + 1}/${new Date(\n          item.createdAt,\n        ).getDate()}  ${new Date(item.createdAt).getHours()}:${\n          new Date(item.createdAt).getMinutes() < 10\n            ? \"0\" + new Date(item.createdAt).getMinutes()\n            : new Date(item.createdAt).getMinutes()\n        }:${\n          new Date(item.createdAt).getSeconds() < 10\n            ? \"0\" + new Date(item.createdAt).getSeconds()\n            : new Date(item.createdAt).getSeconds()\n        }`}\n      >\n        {post.comments.map((reComment, i) => {\n          if (reComment.commentTo === item._id) {\n            return (\n              <ReCommentListItem\n                key={reComment._id}\n                reComment={reComment}\n                post={post}\n                me={me}\n                onDeleteComment={onDeleteComment}\n              />\n            );\n          }\n        })}\n      </Comment>\n    </li>\n  );\n};\n\nexport default CommentListItem;\n"]},"metadata":{},"sourceType":"module"}