{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport React, { useEffect, useCallback, useState } from \"react\";\nimport ArticleLayout from \"../../../components/layout/ArticleLayout\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { loadPostsReqeustAction, initializePostsAction, loadForumPostsRequestAction } from \"../../../reducers/post\";\nimport List from \"../../../components/common/contents/List\";\nimport { Spin, Radio, Select } from \"antd\";\nimport styled from \"styled-components\";\nimport Router, { withRouter } from \"next/router\";\nimport Head from \"next/head\";\nimport wrapper from \"../../../store/configureStore\";\nimport { setUserRequestAction } from \"../../../reducers/user\";\nimport { END } from \"redux-saga\";\nimport client from \"../../../lib/api/client\";\nconst SpinWrapper = styled.div.withConfig({\n  displayName: \"forum__SpinWrapper\",\n  componentId: \"sc-11m321c-0\"\n})([\"text-align:center;margin:100px 0;\"]);\nconst ForumFilterWrapper = styled.div.withConfig({\n  displayName: \"forum__ForumFilterWrapper\",\n  componentId: \"sc-11m321c-1\"\n})([\"margin-bottom:10px;.ant-radio-button-wrapper-checked{color:#888;text-decoration:underline;&:hover{color:#888;}}.ant-radio-button-wrapper{transition:none;&::before{display:none;}&:hover{text-decoration:underline;}background:transparent;color:#888;border:none;font-size:12px;.ant-radio-button{}.ant-radio-button-checked{display:none;}}\"]);\nlet skip = 0;\n\nconst Forum = ({\n  router\n}) => {\n  const {\n    0: radioValue,\n    1: setRadioValue\n  } = useState(\"latest\");\n  const {\n    0: field,\n    1: setField\n  } = useState(\"전체\");\n  const {\n    term\n  } = router.query;\n  const onChangeField = useCallback(e => {\n    setField(e);\n\n    if (term) {\n      Router.push(`/articles/forum?term=${term}`);\n    } else {\n      Router.push(`/articles/forum`);\n    }\n  }, [router]);\n  const onClickRadio = useCallback(e => {\n    setRadioValue(e.target.value);\n  }, []);\n  const onClickSort = useCallback(e => {\n    if (term) {\n      Router.push(`/articles/forum?term=${term}`);\n    } else {\n      Router.push(`/articles/forum`);\n    }\n  }, [router]);\n  const dispatch = useDispatch();\n  const {\n    forumPosts,\n    loadPostsLoading\n  } = useSelector(state => state.post);\n  const {\n    temporalPostsLength\n  } = useSelector(state => state.post);\n\n  const handleScroll = () => {\n    const scrollHeight = document.documentElement.scrollHeight;\n    const scrollTop = document.documentElement.scrollTop;\n    const clientHeight = document.documentElement.clientHeight;\n\n    if (scrollTop + clientHeight >= scrollHeight && !loadPostsLoading) {\n      if (temporalPostsLength >= 10) {\n        dispatch(loadForumPostsRequestAction({\n          type: radioValue,\n          skip,\n          term: router.query.term,\n          field\n        }));\n      }\n\n      skip += 10;\n    }\n  };\n\n  useEffect(() => {\n    dispatch(loadForumPostsRequestAction({\n      type: radioValue,\n      term: router.query.term,\n      skip,\n      field\n    }));\n    skip += 10;\n    return () => {\n      skip = 0;\n      dispatch(initializePostsAction());\n    };\n  }, [router]);\n  useEffect(() => {\n    window.addEventListener(\"scroll\", handleScroll);\n    return () => {\n      window.removeEventListener(\"scroll\", handleScroll);\n    };\n  }, [temporalPostsLength]);\n  return /*#__PURE__*/_jsxs(_Fragment, {\n    children: [/*#__PURE__*/_jsxs(Head, {\n      children: [/*#__PURE__*/_jsx(\"meta\", {\n        charSet: \"utf-8\"\n      }), /*#__PURE__*/_jsx(\"title\", {\n        children: \"\\uD3EC\\uB7FC\"\n      })]\n    }), /*#__PURE__*/_jsxs(ArticleLayout, {\n      contentType: \"forum\",\n      children: [/*#__PURE__*/_jsxs(ForumFilterWrapper, {\n        children: [/*#__PURE__*/_jsxs(Select, {\n          defaultValue: \"\\uC804\\uCCB4\",\n          onChange: onChangeField,\n          children: [/*#__PURE__*/_jsx(Select.Option, {\n            value: \"\\uC804\\uCCB4\",\n            children: \"\\uC804\\uCCB4\"\n          }), /*#__PURE__*/_jsx(Select.Option, {\n            value: \"\\uC790\\uC720\",\n            children: \"\\uC790\\uC720\"\n          }), /*#__PURE__*/_jsx(Select.Option, {\n            value: \"QnA\",\n            children: \"QnA\"\n          })]\n        }), /*#__PURE__*/_jsxs(Radio.Group, {\n          onChange: onClickRadio,\n          defaultValue: \"latest\",\n          children: [/*#__PURE__*/_jsx(Radio.Button, {\n            value: \"latest\",\n            onClick: onClickSort,\n            children: \"\\uCD5C\\uC2E0\\uC21C\"\n          }), /*#__PURE__*/_jsx(Radio.Button, {\n            value: \"likes\",\n            onClick: onClickSort,\n            children: \"\\uCD94\\uCC9C\\uC21C\"\n          }), /*#__PURE__*/_jsx(Radio.Button, {\n            value: \"comments\",\n            onClick: onClickSort,\n            children: \"\\uB313\\uAE00\\uC21C\"\n          }), /*#__PURE__*/_jsx(Radio.Button, {\n            value: \"scraps\",\n            onClick: onClickSort,\n            children: \"\\uC2A4\\uD06C\\uB7A9\\uC21C\"\n          }), /*#__PURE__*/_jsx(Radio.Button, {\n            value: \"views\",\n            onClick: onClickSort,\n            children: \"\\uC870\\uD68C\\uC21C\"\n          })]\n        })]\n      }), /*#__PURE__*/_jsx(List, {\n        data: forumPosts,\n        type: \"forum\"\n      }), loadPostsLoading && /*#__PURE__*/_jsx(SpinWrapper, {\n        children: /*#__PURE__*/_jsx(Spin, {\n          tip: \"\\uBD88\\uB7EC\\uC624\\uB294\\uC911...\"\n        })\n      })]\n    })]\n  });\n};\n\nexport const getServerSideProps = wrapper.getServerSideProps(async context => {\n  //console.log(context);\n  //console.log(\"store1\", context.store.getState());\n  const cookie = context.req ? context.req.headers.cookie : \"\";\n  client.defaults.headers.Cookie = \"\";\n\n  if (context.req && cookie) {\n    //console.log(\"fuckcookie\", cookie);\n    client.defaults.withCredentials = true;\n    client.defaults.headers.Cookie = cookie;\n  }\n\n  context.store.dispatch(setUserRequestAction()); // context.store.dispatch(\n  //   loadForumPostsRequestAction({\n  //     type: \"latest\",\n  //     skip: 0,\n  //     term: \"\",\n  //     field: \"전체\",\n  //   }),\n  // );\n  //context.store.dispatch(mainLoadPostsReqeustAction());\n  //context.store.dispatch(END);\n\n  context.store.dispatch(END);\n  await context.store.sagaTask.toPromise();\n});\nexport default withRouter(Forum);","map":null,"metadata":{},"sourceType":"module"}