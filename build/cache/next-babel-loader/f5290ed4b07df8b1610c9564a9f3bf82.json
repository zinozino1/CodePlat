{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport React, { useEffect, useCallback, useState } from \"react\";\nimport ArticleLayout from \"../../../components/layout/ArticleLayout\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { loadPostsReqeustAction, initializePostsAction //searchPostsRequestAction,\n} from \"../../../reducers/post\";\nimport List from \"../../../components/common/contents/List\";\nimport { Spin, Select } from \"antd\";\nimport styled from \"styled-components\";\nimport { withRouter } from \"next/router\";\nimport Head from \"next/head\";\nimport { Locations } from \"../../../lib/constant/constant\";\nimport wrapper from \"../../../store/configureStore\";\nimport { setUserRequestAction } from \"../../../reducers/user\";\nimport { END } from \"redux-saga\";\nimport client from \"../../../lib/api/client\";\nconst SelectLocationWrapper = styled.div.withConfig({\n  displayName: \"study__SelectLocationWrapper\",\n  componentId: \"sc-10su74g-0\"\n})([\"text-align:right;margin-bottom:10px;\"]);\nconst Label = styled.span.withConfig({\n  displayName: \"study__Label\",\n  componentId: \"sc-10su74g-1\"\n})([\"font-weight:500;\"]);\nconst SpinWrapper = styled.div.withConfig({\n  displayName: \"study__SpinWrapper\",\n  componentId: \"sc-10su74g-2\"\n})([\"text-align:center;margin:100px 0;\"]);\nlet skip = 0;\nconst LocationSelectChildren = [];\nLocations.forEach((v, i) => {\n  LocationSelectChildren.push( /*#__PURE__*/_jsx(Select.Option, {\n    children: v.value\n  }, v.key));\n});\n\nconst Study = ({\n  router\n}) => {\n  //console.log(\"skip : \", skip);\n  const dispatch = useDispatch();\n  const {\n    skill\n  } = useSelector(state => state.skill);\n  const {\n    studyPosts,\n    loadPostsLoading\n  } = useSelector(state => state.post);\n  const {\n    temporalPostsLength\n  } = useSelector(state => state.post);\n  const {\n    0: location,\n    1: setLocation\n  } = useState(\"전체\");\n  const onChangeLocation = useCallback(value => {\n    setLocation(value);\n  }, []);\n\n  const handleScroll = () => {\n    const scrollHeight = document.documentElement.scrollHeight;\n    const scrollTop = document.documentElement.scrollTop;\n    const clientHeight = document.documentElement.clientHeight;\n\n    if (scrollTop + clientHeight >= scrollHeight && !loadPostsLoading) {\n      if (temporalPostsLength >= 10) {\n        dispatch(loadPostsReqeustAction({\n          type: \"study\",\n          skip,\n          techStack: skill,\n          term: router.query.term,\n          location\n        }));\n        skip += 10;\n      }\n    }\n  };\n\n  useEffect(() => {\n    dispatch(loadPostsReqeustAction({\n      type: \"study\",\n      term: router.query.term,\n      skip,\n      techStack: skill,\n      location\n    }));\n    skip += 10;\n    return () => {\n      skip = 0;\n      dispatch(initializePostsAction());\n    };\n  }, [router, skill, location]);\n  useEffect(() => {\n    window.addEventListener(\"scroll\", handleScroll);\n    return () => {\n      window.removeEventListener(\"scroll\", handleScroll);\n    };\n  }, [temporalPostsLength]);\n  return /*#__PURE__*/_jsxs(_Fragment, {\n    children: [/*#__PURE__*/_jsxs(Head, {\n      children: [/*#__PURE__*/_jsx(\"meta\", {\n        charSet: \"utf-8\"\n      }), /*#__PURE__*/_jsx(\"title\", {\n        children: \"\\uC2A4\\uD130\\uB514\"\n      })]\n    }), /*#__PURE__*/_jsxs(ArticleLayout, {\n      contentType: \"study\",\n      children: [/*#__PURE__*/_jsxs(SelectLocationWrapper, {\n        children: [/*#__PURE__*/_jsx(Label, {\n          style: {\n            lineHeight: \"32px\"\n          },\n          children: \"\\uC9C0\\uC5ED\"\n        }), /*#__PURE__*/_jsx(Select, {\n          defaultValue: \"\\uC804\\uCCB4\",\n          bordered: false,\n          style: {\n            color: \"#999\"\n          },\n          onChange: onChangeLocation,\n          children: LocationSelectChildren\n        })]\n      }), /*#__PURE__*/_jsx(List, {\n        data: studyPosts,\n        type: \"study\"\n      }), loadPostsLoading && /*#__PURE__*/_jsx(SpinWrapper, {\n        children: /*#__PURE__*/_jsx(Spin, {\n          tip: \"\\uBD88\\uB7EC\\uC624\\uB294\\uC911...\"\n        })\n      })]\n    })]\n  });\n};\n\nexport const getServerSideProps = wrapper.getServerSideProps(async context => {\n  //console.log(context);\n  const cookie = context.req ? context.req.headers.cookie : \"\";\n  client.defaults.headers.Cookie = \"\";\n\n  if (context.req && cookie) {\n    //console.log(\"fuckcookie\", cookie);\n    client.defaults.withCredentials = true;\n    client.defaults.headers.Cookie = cookie;\n  }\n\n  context.store.dispatch(setUserRequestAction()); //context.store.dispatch(mainLoadPostsReqeustAction());\n  //context.store.dispatch(END);\n\n  context.store.dispatch(END);\n  await context.store.sagaTask.toPromise();\n});\nexport default withRouter(Study);","map":null,"metadata":{},"sourceType":"module"}