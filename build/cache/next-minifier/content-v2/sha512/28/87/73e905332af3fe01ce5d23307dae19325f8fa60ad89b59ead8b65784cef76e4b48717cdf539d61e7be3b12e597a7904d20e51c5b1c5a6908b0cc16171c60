{"code":"_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[47],{\"D/7j\":function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push([\"/mypage\",function(){return n(\"Gck/\")}])},\"Gck/\":function(t,e,n){\"use strict\";n.r(e),n.d(e,\"__N_SSP\",(function(){return D}));var a=n(\"nKUr\"),o=n(\"KQm4\"),c=n(\"o0o1\"),r=n.n(c),i=n(\"HaE+\"),s=n(\"1OyB\"),u=n(\"vuIU\"),f=n(\"JX7q\"),l=n(\"Ji7U\"),h=n(\"md7G\"),d=n(\"foSv\"),p=n(\"rePB\"),m=n(\"q1tI\"),j=n(\"BvKs\"),b=n(\"KrTs\"),O=n(\"cJ7L\"),v=n(\"+GxG\"),x=n(\"y0hu\"),y=n(\"Frsj\"),w=(n(\"cYDJ\"),n(\"oaLA\")),R=(n(\"w9p+\"),n(\"vOnD\")),g=n(\"8Kt/\"),k=n.n(g),C=n(\"XS2M\"),K=n(\"0SdC\"),S=(n(\"LAVF\"),n(\"Ktyj\")),E=n(\"/MKj\"),_=(n(\"je4i\"),n(\"DEwa\"));n(\"so/r\");function N(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function I(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?N(Object(n),!0).forEach((function(e){Object(p.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function M(t){var e=function(){if(\"undefined\"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(\"function\"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Object(d.a)(t);if(e){var o=Object(d.a)(this).constructor;n=Reflect.construct(a,arguments,o)}else n=a.apply(this,arguments);return Object(h.a)(this,n)}}var L=j.a.SubMenu,T=R.b.div.withConfig({displayName:\"mypage__MenuWrapper\",componentId:\"sc-148fna2-0\"})([\"display:flex;.menu-bar{flex:1;width:200px;height:90vh;.ant-menu-item{&:hover{color:#111;}}.ant-menu-item-selected{background:#4f528a;color:#fff;&::after{border-right:none;}&:hover{color:#fff;}}.ant-menu-submenu-title{&:hover{color:#111;.ant-menu-submenu-arrow{color:#111;}}}}.menu-content{flex:4;}@media (max-width:768px){flex-direction:column;.menu-bar{height:100%;width:100%;}.menu-content{margin-bottom:3rem;}}\"]),P=function(t){Object(l.a)(n,t);var e=M(n);function n(t,a){var c;return Object(s.a)(this,n),c=e.call(this,t,a),Object(p.a)(Object(f.a)(c),\"state\",{chatRoomsRef:S.a.database().ref(\"chatRooms\"),messagesRef:S.a.database().ref(\"messages\"),chatRooms:[],chatRoomsLoading:!1,firstLoad:!0,notifications:[],currentMenu:\"profile\",chatRoomKey:\"\"}),Object(p.a)(Object(f.a)(c),\"onChangeCurrentMenu\",(function(t){\"profile\"!==t.key&&\"activity\"!=t.key||c.props.dispatch(Object(_.c)(null)),c.setState({currentMenu:t.key})})),Object(p.a)(Object(f.a)(c),\"setChatRoomKey\",(function(t){c.setState({chatRoomKey:t})})),Object(p.a)(Object(f.a)(c),\"onSetCurrentChatRoom\",(function(t){c.props.dispatch(Object(_.c)(t)),c.clearNotifications(t.id)})),Object(p.a)(Object(f.a)(c),\"addChatRoomListener\",(function(){var t=[];c.state.chatRoomsRef.on(\"child_added\",(function(e){var n=!1;e.val().users.forEach((function(t,e){t.nickname===c.props.me.nickname&&(n=!0)})),n&&(t.push(e.val()),c.setState({chatRooms:t}),c.setState({chatRoomsLoading:!0}),c.addNotificationListener(e.key,e.val()))})),c.setState({chatRoomsLoading:!1})})),Object(p.a)(Object(f.a)(c),\"addNotificationListener\",(function(t,e){c.state.messagesRef.child(t).on(\"value\",(function(n){c.handleNotifications(t,c.props.chatRoom?c.props.chatRoom.id:\"\",c.state.notifications,n,e)}))})),Object(p.a)(Object(f.a)(c),\"handleNotifications\",function(){var t=Object(i.a)(r.a.mark((function t(e,n,a,o,i){var s,u,f;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=0,-1!==(u=a.findIndex((function(t){return t.id===e})))){t.next=9;break}return f=null,t.next=6,S.a.database().ref(\"/chatRooms/\".concat(e,\"/\").concat(c.props.me.nickname)).once(\"value\").then((function(t){f=t.val()}));case 6:f?a.push({id:e,total:f.total,lastKnownTotal:f.lastKnownTotal,count:f.count}):a.push({id:e,total:o.numChildren(),lastKnownTotal:o.numChildren(),count:0}),t.next=11;break;case 9:e!==n?(s=a[u].lastKnownTotal,o.numChildren()-s>0&&(a[u].count=o.numChildren()-s)):a[u].lastKnownTotal=o.numChildren(),a[u].total=o.numChildren();case 11:c.setState({notifications:a});case 12:case\"end\":return t.stop()}}),t)})));return function(e,n,a,o,c){return t.apply(this,arguments)}}()),Object(p.a)(Object(f.a)(c),\"clearNotifications\",function(){var t=Object(i.a)(r.a.mark((function t(e){var n,a;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(-1===(n=c.state.notifications.findIndex((function(t){return t.id===e})))){t.next=8;break}return(a=Object(o.a)(c.state.notifications))[n].lastKnownTotal=c.state.notifications[n].total,a[n].count=0,c.setState({notifications:a}),t.next=8,c.state.chatRoomsRef.child(e).child(c.props.me.nickname).remove();case 8:case\"end\":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),Object(p.a)(Object(f.a)(c),\"getNotificationCount\",(function(t){var e=0;if(c.state.notifications.forEach((function(n){n.id===t.id&&(e=n.count)})),e>0)return e})),Object(p.a)(Object(f.a)(c),\"setFirstChatRoom\",(function(){var t=c.state.chatRooms[0];c.state.firstLoad&&c.state.chatRooms.length>0&&c.props.dispatch(Object(_.c)(t)),c.setState({firstLoad:!1})})),Object(p.a)(Object(f.a)(c),\"componentCleanup\",(function(){var t=[];c.state.notifications.forEach((function(e,n){e.total!==e.lastKnownTotal&&t.push({chatRoomId:e.id,user:c.props.me.nickname,total:e.total,lastKnownTotal:e.lastKnownTotal,count:e.count})})),t&&t.forEach(function(){var t=Object(i.a)(r.a.mark((function t(e,n){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,c.state.chatRoomsRef.child(e.chatRoomId).child(c.props.me.nickname).update(I({},e));case 2:case\"end\":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())})),c.componentCleanup=c.componentCleanup.bind(Object(f.a)(c)),c}return Object(u.a)(n,[{key:\"componentDidMount\",value:function(){var t=Object(i.a)(r.a.mark((function t(){var e,n;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,S.a.auth().signInWithEmailAndPassword(this.props.me.email,this.props.me.email);case 2:return e=null,n=S.a.auth().currentUser,t.next=6,S.a.database().ref(\"users\").child(n.uid).once(\"value\",(function(t){e=t.val()}));case 6:return t.next=8,S.a.database().ref(\"users\").child(n.uid).update(I(I({},e),{},{isInMypage:!0}));case 8:window.addEventListener(\"beforeunload\",this.componentCleanup),this.addChatRoomListener();case 10:case\"end\":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:\"componentWillUnmount\",value:function(){var t=Object(i.a)(r.a.mark((function t(){var e,n,a,o=this;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=null,n=S.a.auth().currentUser,t.next=4,S.a.database().ref(\"users\").child(n.uid).once(\"value\",(function(t){e=t.val()}));case 4:return t.next=6,S.a.database().ref(\"users\").child(n.uid).update(I(I({},e),{},{isInMypage:!1}));case 6:window.removeEventListener(\"beforeunload\",this.componentCleanup),a=[],this.state.notifications.forEach((function(t,e){t.total!==t.lastKnownTotal&&a.push({chatRoomId:t.id,user:o.props.me.nickname,total:t.total,lastKnownTotal:t.lastKnownTotal,count:t.count})})),a&&a.forEach(function(){var t=Object(i.a)(r.a.mark((function t(e,n){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.state.chatRoomsRef.child(e.chatRoomId).child(o.props.me.nickname).update(I({},e));case 2:case\"end\":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()),this.state.chatRoomsRef.off(),this.state.chatRooms.forEach((function(t){o.state.messagesRef.child(t.id).off()}));case 12:case\"end\":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:\"render\",value:function(){var t=this,e=this.state.chatRooms,n=this.props.me;return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsxs)(k.a,{children:[Object(a.jsx)(\"meta\",{charSet:\"utf-8\"}),Object(a.jsx)(\"title\",{children:\"\\ub9c8\\uc774\\ud398\\uc774\\uc9c0\"})]}),Object(a.jsx)(y.a,{children:Object(a.jsxs)(T,{children:[Object(a.jsx)(\"div\",{className:\"menu-bar\",children:Object(a.jsxs)(j.a,{mode:\"inline\",style:{height:\"100%\"},defaultSelectedKeys:[\"profile\"],onClick:this.onChangeCurrentMenu,children:[Object(a.jsx)(j.a.Item,{icon:Object(a.jsx)(O.a,{}),children:\"\\ud504\\ub85c\\ud544 \\uc218\\uc815\"},\"profile\"),Object(a.jsx)(j.a.Item,{icon:Object(a.jsx)(v.a,{}),children:\"\\ub0b4 \\ud65c\\ub3d9\"},\"activity\"),Object(a.jsx)(L,{icon:Object(a.jsx)(x.a,{}),title:\"\\ucc44\\ud305\",onClick:this.onChangeCurrentMenu,children:Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(\"span\",{style:{color:\"transparent\"},children:\"loading\"}),e&&e.map((function(e,o){var c=!1;if(e.users.forEach((function(t,e){n&&t.clientId===n._id&&(c=!0)})),c)return Object(a.jsx)(j.a.Item,{onClick:function(n){t.setChatRoomKey(e.id),t.onSetCurrentChatRoom(e)},children:Object(a.jsxs)(\"div\",{style:{display:\"flex\",justifyContent:\"space-between\"},children:[Object(a.jsx)(\"span\",{style:{},children:e.users.filter((function(t,e){if(n&&t.nickname!==n.nickname)return t}))[0].nickname}),Object(a.jsx)(\"span\",{children:Object(a.jsx)(b.a,{count:t.getNotificationCount(e),style:{borderRadius:\"3px\",fontSize:\"9px\",padding:\"0 2px\",height:\"13px\",minWidth:\"13px\",lineHeight:\"13px\"}})})]})},e.users.filter((function(t,e){if(n&&t.nickname!==n.nickname)return t}))[0].nickname);c=!1}))]})},\"note\")]})}),Object(a.jsxs)(\"div\",{className:\"menu-content\",children:[\"profile\"===this.state.currentMenu&&Object(a.jsx)(C.a,{}),\"activity\"===this.state.currentMenu&&Object(a.jsx)(w.a,{}),\"profile\"!==this.state.currentMenu&&\"activity\"!==this.state.currentMenu&&Object(a.jsx)(K.a,{chatRoomKey:this.state.chatRoomKey})]})]})})]})}}]),n}(m.Component),D=!0;e.default=Object(E.b)((function(t){return{me:t.user.me,chatRoom:t.chat.currentChatRoom}}))(P)}},[[\"D/7j\",0,1,5,6,24,2,4,3,7,8,9,10,11,12,14,15,17,16,22,25]]]);","extractedComments":[]}